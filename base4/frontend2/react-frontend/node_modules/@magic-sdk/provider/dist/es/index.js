var zt=Object.create;var Ce=Object.defineProperty;var Yt=Object.getOwnPropertyDescriptor;var Qt=Object.getOwnPropertyNames;var Zt=Object.getPrototypeOf,er=Object.prototype.hasOwnProperty;var tr=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),rr=(r,e)=>{for(var t in e)Ce(r,t,{get:e[t],enumerable:!0})},nr=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Qt(e))!er.call(r,n)&&n!==t&&Ce(r,n,{get:()=>e[n],enumerable:!(s=Yt(e,n))||s.enumerable});return r};var sr=(r,e,t)=>(t=r!=null?zt(Zt(r)):{},nr(e||!r||!r.__esModule?Ce(t,"default",{value:r,enumerable:!0}):t,r));var Nt=tr((ls,ke)=>{"use strict";var pn=Object.prototype.hasOwnProperty,I="~";function se(){}Object.create&&(se.prototype=Object.create(null),new se().__proto__||(I=!1));function mn(r,e,t){this.fn=r,this.context=e,this.once=t||!1}function Mt(r,e,t,s,n){if(typeof t!="function")throw new TypeError("The listener must be a function");var o=new mn(t,s||r,n),i=I?I+e:e;return r._events[i]?r._events[i].fn?r._events[i]=[r._events[i],o]:r._events[i].push(o):(r._events[i]=o,r._eventsCount++),r}function fe(r,e){--r._eventsCount===0?r._events=new se:delete r._events[e]}function v(){this._events=new se,this._eventsCount=0}v.prototype.eventNames=function(){var e=[],t,s;if(this._eventsCount===0)return e;for(s in t=this._events)pn.call(t,s)&&e.push(I?s.slice(1):s);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};v.prototype.listeners=function(e){var t=I?I+e:e,s=this._events[t];if(!s)return[];if(s.fn)return[s.fn];for(var n=0,o=s.length,i=new Array(o);n<o;n++)i[n]=s[n].fn;return i};v.prototype.listenerCount=function(e){var t=I?I+e:e,s=this._events[t];return s?s.fn?1:s.length:0};v.prototype.emit=function(e,t,s,n,o,i){var a=I?I+e:e;if(!this._events[a])return!1;var c=this._events[a],d=arguments.length,l,u;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,s),!0;case 4:return c.fn.call(c.context,t,s,n),!0;case 5:return c.fn.call(c.context,t,s,n,o),!0;case 6:return c.fn.call(c.context,t,s,n,o,i),!0}for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var P=c.length,w;for(u=0;u<P;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,s);break;case 4:c[u].fn.call(c[u].context,t,s,n);break;default:if(!l)for(w=1,l=new Array(d-1);w<d;w++)l[w-1]=arguments[w];c[u].fn.apply(c[u].context,l)}}return!0};v.prototype.on=function(e,t,s){return Mt(this,e,t,s,!1)};v.prototype.once=function(e,t,s){return Mt(this,e,t,s,!0)};v.prototype.removeListener=function(e,t,s,n){var o=I?I+e:e;if(!this._events[o])return this;if(!t)return fe(this,o),this;var i=this._events[o];if(i.fn)i.fn===t&&(!n||i.once)&&(!s||i.context===s)&&fe(this,o);else{for(var a=0,c=[],d=i.length;a<d;a++)(i[a].fn!==t||n&&!i[a].once||s&&i[a].context!==s)&&c.push(i[a]);c.length?this._events[o]=c.length===1?c[0]:c:fe(this,o)}return this};v.prototype.removeAllListeners=function(e){var t;return e?(t=I?I+e:e,this._events[t]&&fe(this,t)):(this._events=new se,this._eventsCount=0),this};v.prototype.off=v.prototype.removeListener;v.prototype.addListener=v.prototype.on;v.prefixed=I;v.EventEmitter=v;typeof ke<"u"&&(ke.exports=v)});function or(r){let e={exports:{}};return r(e,e.exports),e.exports}var ir=Number.MAX_SAFE_INTEGER||9007199254740991;var $e={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:ir,MAX_SAFE_COMPONENT_LENGTH:16},ar=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{},h=ar,ee=or(function(r,e){let{MAX_SAFE_COMPONENT_LENGTH:t}=$e,s=(e=r.exports={}).re=[],n=e.src=[],o=e.t={},i=0,a=(c,d,l)=>{let u=i++;h(u,d),o[c]=u,n[u]=d,s[u]=new RegExp(d,l?"g":void 0)};a("NUMERICIDENTIFIER","0|[1-9]\\d*"),a("NUMERICIDENTIFIERLOOSE","[0-9]+"),a("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),a("MAINVERSION",`(${n[o.NUMERICIDENTIFIER]})\\.(${n[o.NUMERICIDENTIFIER]})\\.(${n[o.NUMERICIDENTIFIER]})`),a("MAINVERSIONLOOSE",`(${n[o.NUMERICIDENTIFIERLOOSE]})\\.(${n[o.NUMERICIDENTIFIERLOOSE]})\\.(${n[o.NUMERICIDENTIFIERLOOSE]})`),a("PRERELEASEIDENTIFIER",`(?:${n[o.NUMERICIDENTIFIER]}|${n[o.NONNUMERICIDENTIFIER]})`),a("PRERELEASEIDENTIFIERLOOSE",`(?:${n[o.NUMERICIDENTIFIERLOOSE]}|${n[o.NONNUMERICIDENTIFIER]})`),a("PRERELEASE",`(?:-(${n[o.PRERELEASEIDENTIFIER]}(?:\\.${n[o.PRERELEASEIDENTIFIER]})*))`),a("PRERELEASELOOSE",`(?:-?(${n[o.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${n[o.PRERELEASEIDENTIFIERLOOSE]})*))`),a("BUILDIDENTIFIER","[0-9A-Za-z-]+"),a("BUILD",`(?:\\+(${n[o.BUILDIDENTIFIER]}(?:\\.${n[o.BUILDIDENTIFIER]})*))`),a("FULLPLAIN",`v?${n[o.MAINVERSION]}${n[o.PRERELEASE]}?${n[o.BUILD]}?`),a("FULL",`^${n[o.FULLPLAIN]}$`),a("LOOSEPLAIN",`[v=\\s]*${n[o.MAINVERSIONLOOSE]}${n[o.PRERELEASELOOSE]}?${n[o.BUILD]}?`),a("LOOSE",`^${n[o.LOOSEPLAIN]}$`),a("GTLT","((?:<|>)?=?)"),a("XRANGEIDENTIFIERLOOSE",`${n[o.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),a("XRANGEIDENTIFIER",`${n[o.NUMERICIDENTIFIER]}|x|X|\\*`),a("XRANGEPLAIN",`[v=\\s]*(${n[o.XRANGEIDENTIFIER]})(?:\\.(${n[o.XRANGEIDENTIFIER]})(?:\\.(${n[o.XRANGEIDENTIFIER]})(?:${n[o.PRERELEASE]})?${n[o.BUILD]}?)?)?`),a("XRANGEPLAINLOOSE",`[v=\\s]*(${n[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${n[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${n[o.XRANGEIDENTIFIERLOOSE]})(?:${n[o.PRERELEASELOOSE]})?${n[o.BUILD]}?)?)?`),a("XRANGE",`^${n[o.GTLT]}\\s*${n[o.XRANGEPLAIN]}$`),a("XRANGELOOSE",`^${n[o.GTLT]}\\s*${n[o.XRANGEPLAINLOOSE]}$`),a("COERCE",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?(?:$|[^\\d])`),a("COERCERTL",n[o.COERCE],!0),a("LONETILDE","(?:~>?)"),a("TILDETRIM",`(\\s*)${n[o.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",a("TILDE",`^${n[o.LONETILDE]}${n[o.XRANGEPLAIN]}$`),a("TILDELOOSE",`^${n[o.LONETILDE]}${n[o.XRANGEPLAINLOOSE]}$`),a("LONECARET","(?:\\^)"),a("CARETTRIM",`(\\s*)${n[o.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",a("CARET",`^${n[o.LONECARET]}${n[o.XRANGEPLAIN]}$`),a("CARETLOOSE",`^${n[o.LONECARET]}${n[o.XRANGEPLAINLOOSE]}$`),a("COMPARATORLOOSE",`^${n[o.GTLT]}\\s*(${n[o.LOOSEPLAIN]})$|^$`),a("COMPARATOR",`^${n[o.GTLT]}\\s*(${n[o.FULLPLAIN]})$|^$`),a("COMPARATORTRIM",`(\\s*)${n[o.GTLT]}\\s*(${n[o.LOOSEPLAIN]}|${n[o.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",a("HYPHENRANGE",`^\\s*(${n[o.XRANGEPLAIN]})\\s+-\\s+(${n[o.XRANGEPLAIN]})\\s*$`),a("HYPHENRANGELOOSE",`^\\s*(${n[o.XRANGEPLAINLOOSE]})\\s+-\\s+(${n[o.XRANGEPLAINLOOSE]})\\s*$`),a("STAR","(<|>)?=?\\s*\\*"),a("GTE0","^\\s*>=\\s*0.0.0\\s*$"),a("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")}),Xe=/^[0-9]+$/,st=(r,e)=>{let t=Xe.test(r),s=Xe.test(e);return t&&s&&(r=+r,e=+e),r===e?0:t&&!s?-1:s&&!t?1:r<e?-1:1},cr=(r,e)=>st(e,r),lr={compareIdentifiers:st,rcompareIdentifiers:cr},{MAX_LENGTH:ze,MAX_SAFE_INTEGER:ie}=$e,{re:Ye,t:Qe}=ee,{compareIdentifiers:z}=lr,M=class r{constructor(e,t){if(t&&typeof t=="object"||(t={loose:!!t,includePrerelease:!1}),e instanceof r){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid Version: ${e}`);if(e.length>ze)throw new TypeError(`version is longer than ${ze} characters`);h("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let s=e.trim().match(t.loose?Ye[Qe.LOOSE]:Ye[Qe.FULL]);if(!s)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+s[1],this.minor=+s[2],this.patch=+s[3],this.major>ie||this.major<0)throw new TypeError("Invalid major version");if(this.minor>ie||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>ie||this.patch<0)throw new TypeError("Invalid patch version");s[4]?this.prerelease=s[4].split(".").map(n=>{if(/^[0-9]+$/.test(n)){let o=+n;if(o>=0&&o<ie)return o}return n}):this.prerelease=[],this.build=s[5]?s[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(h("SemVer.compare",this.version,this.options,e),!(e instanceof r)){if(typeof e=="string"&&e===this.version)return 0;e=new r(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof r||(e=new r(e,this.options)),z(this.major,e.major)||z(this.minor,e.minor)||z(this.patch,e.patch)}comparePre(e){if(e instanceof r||(e=new r(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let s=this.prerelease[t],n=e.prerelease[t];if(h("prerelease compare",t,s,n),s===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(s===void 0)return-1;if(s!==n)return z(s,n)}while(++t)}compareBuild(e){e instanceof r||(e=new r(e,this.options));let t=0;do{let s=this.build[t],n=e.build[t];if(h("prerelease compare",t,s,n),s===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(s===void 0)return-1;if(s!==n)return z(s,n)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t),this.inc("pre",t);break;case"major":this.minor===0&&this.patch===0&&this.prerelease.length!==0||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":this.patch===0&&this.prerelease.length!==0||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);s===-1&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}},dr=(r,e,t)=>new M(r,t).compare(new M(e,t)),J=dr,ur=(r,e,t)=>J(r,e,t)===0,pr=ur,mr=(r,e,t)=>J(r,e,t)!==0,hr=mr,Er=(r,e,t)=>J(r,e,t)>0,fr=Er,gr=(r,e,t)=>J(r,e,t)>=0,yr=gr,Rr=(r,e,t)=>J(r,e,t)<0,vr=Rr,Tr=(r,e,t)=>J(r,e,t)<=0,Ir=Tr,br=(r,e,t,s)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return pr(r,t,s);case"!=":return hr(r,t,s);case">":return fr(r,t,s);case">=":return yr(r,t,s);case"<":return vr(r,t,s);case"<=":return Ir(r,t,s);default:throw new TypeError(`Invalid operator: ${e}`)}},Ae=br,Y=Symbol("SemVer ANY"),Q=class r{static get ANY(){return Y}constructor(e,t){if(t&&typeof t=="object"||(t={loose:!!t,includePrerelease:!1}),e instanceof r){if(e.loose===!!t.loose)return e;e=e.value}h("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===Y?this.value="":this.value=this.operator+this.semver.version,h("comp",this)}parse(e){let t=this.options.loose?Ze[et.COMPARATORLOOSE]:Ze[et.COMPARATOR],s=e.match(t);if(!s)throw new TypeError(`Invalid comparator: ${e}`);this.operator=s[1]!==void 0?s[1]:"",this.operator==="="&&(this.operator=""),s[2]?this.semver=new M(s[2],this.options.loose):this.semver=Y}toString(){return this.value}test(e){if(h("Comparator.test",e,this.options.loose),this.semver===Y||e===Y)return!0;if(typeof e=="string")try{e=new M(e,this.options)}catch{return!1}return Ae(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Comparator is required");if(t&&typeof t=="object"||(t={loose:!!t,includePrerelease:!1}),this.operator==="")return this.value===""||new Z(e.value,t).test(this.value);if(e.operator==="")return e.value===""||new Z(this.value,t).test(e.semver);let s=!(this.operator!==">="&&this.operator!==">"||e.operator!==">="&&e.operator!==">"),n=!(this.operator!=="<="&&this.operator!=="<"||e.operator!=="<="&&e.operator!=="<"),o=this.semver.version===e.semver.version,i=!(this.operator!==">="&&this.operator!=="<="||e.operator!==">="&&e.operator!=="<="),a=Ae(this.semver,"<",e.semver,t)&&(this.operator===">="||this.operator===">")&&(e.operator==="<="||e.operator==="<"),c=Ae(this.semver,">",e.semver,t)&&(this.operator==="<="||this.operator==="<")&&(e.operator===">="||e.operator===">");return s||n||o&&i||a||c}},{re:Ze,t:et}=ee,Z=class r{constructor(e,t){if(t&&typeof t=="object"||(t={loose:!!t,includePrerelease:!1}),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof Q)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(s=>this.parseRange(s.trim())).filter(s=>s.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);this.format()}format(){return this.range=this.set.map(e=>e.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(e){let{loose:t}=this.options;e=e.trim();let s=t?y[E.HYPHENRANGELOOSE]:y[E.HYPHENRANGE];e=e.replace(s,kr(this.options.includePrerelease)),h("hyphen replace",e),e=e.replace(y[E.COMPARATORTRIM],Pr),h("comparator trim",e,y[E.COMPARATORTRIM]),e=(e=(e=e.replace(y[E.TILDETRIM],wr)).replace(y[E.CARETTRIM],Sr)).split(/\s+/).join(" ");let n=t?y[E.COMPARATORLOOSE]:y[E.COMPARATOR];return e.split(" ").map(o=>xr(o,this.options)).join(" ").split(/\s+/).map(o=>_r(o,this.options)).filter(this.options.loose?o=>!!o.match(n):()=>!0).map(o=>new Q(o,this.options))}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some(s=>tt(s,t)&&e.set.some(n=>tt(n,t)&&s.every(o=>n.every(i=>o.intersects(i,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new M(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(Dr(this.set[t],e,this.options))return!0;return!1}},{re:y,t:E,comparatorTrimReplace:Pr,tildeTrimReplace:wr,caretTrimReplace:Sr}=ee,tt=(r,e)=>{let t=!0,s=r.slice(),n=s.pop();for(;t&&s.length;)t=s.every(o=>n.intersects(o,e)),n=s.pop();return t},xr=(r,e)=>(h("comp",r,e),r=Cr(r,e),h("caret",r),r=Mr(r,e),h("tildes",r),r=$r(r,e),h("xrange",r),r=Or(r,e),h("stars",r),r),T=r=>!r||r.toLowerCase()==="x"||r==="*",Mr=(r,e)=>r.trim().split(/\s+/).map(t=>Nr(t,e)).join(" "),Nr=(r,e)=>{let t=e.loose?y[E.TILDELOOSE]:y[E.TILDE];return r.replace(t,(s,n,o,i,a)=>{let c;return h("tilde",r,s,n,o,i,a),T(n)?c="":T(o)?c=`>=${n}.0.0 <${+n+1}.0.0-0`:T(i)?c=`>=${n}.${o}.0 <${n}.${+o+1}.0-0`:a?(h("replaceTilde pr",a),c=`>=${n}.${o}.${i}-${a} <${n}.${+o+1}.0-0`):c=`>=${n}.${o}.${i} <${n}.${+o+1}.0-0`,h("tilde return",c),c})},Cr=(r,e)=>r.trim().split(/\s+/).map(t=>Ar(t,e)).join(" "),Ar=(r,e)=>{h("caret",r,e);let t=e.loose?y[E.CARETLOOSE]:y[E.CARET],s=e.includePrerelease?"-0":"";return r.replace(t,(n,o,i,a,c)=>{let d;return h("caret",r,n,o,i,a,c),T(o)?d="":T(i)?d=`>=${o}.0.0${s} <${+o+1}.0.0-0`:T(a)?d=o==="0"?`>=${o}.${i}.0${s} <${o}.${+i+1}.0-0`:`>=${o}.${i}.0${s} <${+o+1}.0.0-0`:c?(h("replaceCaret pr",c),d=o==="0"?i==="0"?`>=${o}.${i}.${a}-${c} <${o}.${i}.${+a+1}-0`:`>=${o}.${i}.${a}-${c} <${o}.${+i+1}.0-0`:`>=${o}.${i}.${a}-${c} <${+o+1}.0.0-0`):(h("no pr"),d=o==="0"?i==="0"?`>=${o}.${i}.${a}${s} <${o}.${i}.${+a+1}-0`:`>=${o}.${i}.${a}${s} <${o}.${+i+1}.0-0`:`>=${o}.${i}.${a} <${+o+1}.0.0-0`),h("caret return",d),d})},$r=(r,e)=>(h("replaceXRanges",r,e),r.split(/\s+/).map(t=>Lr(t,e)).join(" ")),Lr=(r,e)=>{r=r.trim();let t=e.loose?y[E.XRANGELOOSE]:y[E.XRANGE];return r.replace(t,(s,n,o,i,a,c)=>{h("xRange",r,s,n,o,i,a,c);let d=T(o),l=d||T(i),u=l||T(a),P=u;return n==="="&&P&&(n=""),c=e.includePrerelease?"-0":"",d?s=n===">"||n==="<"?"<0.0.0-0":"*":n&&P?(l&&(i=0),a=0,n===">"?(n=">=",l?(o=+o+1,i=0,a=0):(i=+i+1,a=0)):n==="<="&&(n="<",l?o=+o+1:i=+i+1),n==="<"&&(c="-0"),s=`${n+o}.${i}.${a}${c}`):l?s=`>=${o}.0.0${c} <${+o+1}.0.0-0`:u&&(s=`>=${o}.${i}.0${c} <${o}.${+i+1}.0-0`),h("xRange return",s),s})},Or=(r,e)=>(h("replaceStars",r,e),r.trim().replace(y[E.STAR],"")),_r=(r,e)=>(h("replaceGTE0",r,e),r.trim().replace(y[e.includePrerelease?E.GTE0PRE:E.GTE0],"")),kr=r=>(e,t,s,n,o,i,a,c,d,l,u,P,w)=>`${t=T(s)?"":T(n)?`>=${s}.0.0${r?"-0":""}`:T(o)?`>=${s}.${n}.0${r?"-0":""}`:i?`>=${t}`:`>=${t}${r?"-0":""}`} ${c=T(d)?"":T(l)?`<${+d+1}.0.0-0`:T(u)?`<${d}.${+l+1}.0-0`:P?`<=${d}.${l}.${u}-${P}`:r?`<${d}.${l}.${+u+1}-0`:`<=${c}`}`.trim(),Dr=(r,e,t)=>{for(let s=0;s<r.length;s++)if(!r[s].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let s=0;s<r.length;s++)if(h(r[s].semver),r[s].semver!==Q.ANY&&r[s].semver.prerelease.length>0){let n=r[s].semver;if(n.major===e.major&&n.minor===e.minor&&n.patch===e.patch)return!0}return!1}return!0},ot=(r,e,t)=>{try{e=new Z(e,t)}catch{return!1}return e.test(r)};var{MAX_LENGTH:qr}=$e,{re:rt,t:nt}=ee,Ur=(r,e)=>{if(e&&typeof e=="object"||(e={loose:!!e,includePrerelease:!1}),r instanceof M)return r;if(typeof r!="string"||r.length>qr||!(e.loose?rt[nt.LOOSE]:rt[nt.FULL]).test(r))return null;try{return new M(r,e)}catch{return null}},Fr=Ur,{re:ae,t:ce}=ee,it=(r,e)=>{if(r instanceof M)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;let t=null;if((e=e||{}).rtl){let s;for(;(s=ae[ce.COERCERTL].exec(r))&&(!t||t.index+t[0].length!==r.length);)t&&s.index+s[0].length===t.index+t[0].length||(t=s),ae[ce.COERCERTL].lastIndex=s.index+s[1].length+s[2].length;ae[ce.COERCERTL].lastIndex=-1}else t=r.match(ae[ce.COERCE]);return t===null?null:Fr(`${t[2]}.${t[3]||"0"}.${t[4]||"0"}`,e)};function Wr(r){return String.fromCharCode(parseInt(r.slice(1),16))}function Jr(r){return`%${`00${r.charCodeAt(0).toString(16)}`.slice(-2)}`}function Gr(r){return btoa(encodeURIComponent(r).replace(/%[0-9A-F]{2}/g,Wr))}function Kr(r){return decodeURIComponent(Array.from(atob(r),Jr).join(""))}function le(r){return Gr(JSON.stringify(r))}function at(r){return JSON.parse(Kr(r))}import{RPCErrorCode as Xr,SDKErrorCode as G,SDKWarningCode as pe}from"@magic-sdk/types";import{MagicPayloadMethod as jr,RPCErrorCode as Vr}from"@magic-sdk/types";function C(r){return typeof r>"u"}function Br(r){return r===null}function de(r){return Br(r)||C(r)}function Un(r){return de(r)?!1:!C(r.jsonrpc)&&!C(r.id)&&!C(r.method)&&!C(r.params)}function ct(r){return de(r)?!1:!C(r.jsonrpc)&&!C(r.id)&&(!C(r.result)||!C(r.error))}function Fn(r){return de(r)?!1:typeof r=="string"&&Object.values(jr).includes(r)}function lt(r){return de(r)?!1:typeof r=="number"&&Object.values(Vr).includes(r)}function te(r){if(!r)return!0;for(let e in r)if(Object.hasOwnProperty.call(r,e))return!1;return!0}var m={};function Hr(r,e){return Object.assign(m,e),r}var dt={"magic-sdk":"magic-sdk","@magic-sdk/react-native":"magic-sdk-rn","@magic-sdk/react-native-bare":"magic-sdk-rn-bare","@magic-sdk/react-native-expo":"magic-sdk-rn-expo"};var $=class r extends Error{constructor(t,s){super(`Magic SDK Error: [${t}] ${s}`);this.code=t;this.rawMessage=s;Object.setPrototypeOf(this,r.prototype)}__proto__=Error},U=class r extends Error{__proto__=Error;code;rawMessage;data;constructor(e){super();let t=Number(e?.code);this.rawMessage=e?.message||"Internal error",this.code=lt(t)?t:Xr.InternalError,this.message=`Magic RPC Error: [${this.code}] ${this.rawMessage}`,this.data=e?.data||void 0,Object.setPrototypeOf(this,r.prototype)}},L=class{constructor(e,t){this.code=e;this.rawMessage=t;this.message=`Magic SDK Warning: [${e}] ${t}`}message;log(){console.warn(this.message)}},ue=class r extends Error{constructor(t,s,n,o){super(`Magic Extension Error (${t.name}): [${s}] ${n}`);this.code=s;this.rawMessage=n;this.data=o;Object.setPrototypeOf(this,r.prototype)}__proto__=Error},re=class{constructor(e,t,s){this.code=t;this.rawMessage=s;this.message=`Magic Extension Warning (${e.name}): [${t}] ${s}`}message;log(){console.warn(this.message)}};function ut(){return new $(G.MissingApiKey,"Please provide an API key that you acquired from the Magic developer dashboard.")}function pt(){return new $(G.ModalNotReady,"Modal is not ready")}function mt(){return new $(G.MalformedResponse,"Response from the Magic iframe is malformed.")}function ht(r){return new $(G.ExtensionNotInitialized,`Extensions must be initialized with a Magic SDK instance before \`Extension.${r}\` can be accessed. Do not invoke \`Extension.${r}\` inside an extension constructor.`)}function Et(r){let e=`Some extensions are incompatible with \`${m.sdkName}@${m.version}\`:`;return r.filter(t=>typeof t.compat<"u"&&t.compat!==null).forEach(t=>{let s=t.compat[m.sdkName];typeof s=="string"?e+=`
  - Extension \`${t.name}\` supports version(s) \`${s}\``:s||(e+=`
  - Extension \`${t.name}\` does not support ${m.platform} environments.`)}),new $(G.IncompatibleExtensions,e)}function ft(r){let e=t=>{let s=t+1,n=s%10,o=s%100;return n===1&&o!==11?`${s}st`:n===2&&o!==12?`${s}nd`:n===3&&o!==13?`${s}rd`:`${s}th`};return new $(G.InvalidArgument,`Invalid ${e(r.argument)} argument given to \`${r.procedure}\`.
  Expected: \`${r.expected}\`
  Received: \`${r.received}\``)}function Bn(){return new L(pe.DuplicateIframe,"Duplicate iframes found.")}function gt(){return new L(pe.SyncWeb3Method,"Non-async web3 methods are deprecated in web3 > 1.0 and are not supported by the Magic web3 provider. Please use an async method instead.")}function yt(){return new L(pe.ReactNativeEndpointConfiguration,`CUSTOM DOMAINS ARE NOT SUPPORTED WHEN USING MAGIC SDK WITH REACT NATIVE! The \`endpoint\` parameter SHOULD NOT be provided. The Magic \`<iframe>\` is automatically wrapped by a WebView pointed at \`${m.defaultEndpoint}\`. Changing this default behavior will lead to unexpected results and potentially security-threatening bugs.`)}function Rt(r){let{method:e,removalVersions:t,useInstead:s}=r,n=t[m.sdkName],o=s?` Use \`${s}\` instead.`:"",i=`\`${e}\` will be removed from \`${m.sdkName}\` in version \`${n}\`.${o}`;return new L(pe.DeprecationNotice,i)}import{MagicPayloadMethod as x,DeviceVerificationEventEmit as Ot,LoginWithEmailOTPEventEmit as N,UpdateEmailEventEmit as j,RecencyCheckEventEmit as _,LoginWithSmsOTPEventEmit as ye}from"@magic-sdk/types";import{MagicOutgoingWindowMessage as fn,MagicIncomingWindowMessage as gn,MagicPayloadMethod as yn,routeToMagicMethods as Rn}from"@magic-sdk/types";import{RPCErrorCode as dn}from"@magic-sdk/types";function*zr(){let r=0;for(;;)r<Number.MAX_SAFE_INTEGER?yield++r:r=0}var Yr=zr();function Le(){return Yr.next().value}var he={};rr(he,{clear:()=>Qr,getItem:()=>R,iterate:()=>Oe,key:()=>en,keys:()=>tn,length:()=>Zr,removeItem:()=>A,setItem:()=>S});var me;function O(r){return async(...e)=>(me||(me=await m.configureStorage()),await me.ready(),me[r](...e))}var R=O("getItem"),S=O("setItem"),A=O("removeItem"),Qr=O("clear"),Zr=O("length"),en=O("key"),tn=O("keys"),Oe=O("iterate");function vt(){let r=window.crypto.getRandomValues(new Uint8Array(16));r[6]=r[6]&15|64,r[8]=r[8]&191|128;let e="";return e+=r[0].toString(16),e+=r[1].toString(16),e+=r[2].toString(16),e+=r[3].toString(16),e+="-",e+=r[4].toString(16),e+=r[5].toString(16),e+="-",e+=r[6].toString(16),e+=r[7].toString(16),e+="-",e+=r[8].toString(16),e+=r[9].toString(16),e+="-",e+=r[10].toString(16),e+=r[11].toString(16),e+=r[12].toString(16),e+=r[13].toString(16),e+=r[14].toString(16),e+=r[15].toString(16),e}var _e="STORE_KEY_PRIVATE_KEY",Ee="STORE_KEY_PUBLIC_JWK",It="ECDSA",rn="P-256",nn={name:It,namedCurve:rn};function ne(){let r=typeof window<"u"&&!!window.crypto,e=r&&!!window.crypto.subtle;return r&&e}function bt(){A(Ee),A(_e)}async function Pt(){let r=await sn();if(!r){console.info("unable to create public key or webcrypto is unsupported");return}let{subtle:e}=window.crypto,t=await R(_e);if(!t||!e){console.info("unable to find private key or webcrypto unsupported");return}let s={iat:Math.floor(new Date().getTime()/1e3),jti:vt()},o={protected:Tt(JSON.stringify({typ:"dpop+jwt",alg:"ES256",jwk:r})),claims:Tt(JSON.stringify(s))},i=an(`${o.protected}.${o.claims}`),a={name:It,hash:{name:"SHA-256"}},c=ln(new Uint8Array(await e.sign(a,t,i)));return`${o.protected}.${o.claims}.${c}`}async function sn(){if(!ne()){console.info("webcrypto is not supported");return}return await R(Ee)||await on(),R(Ee)}async function on(){let{subtle:r}=window.crypto,e=await r.generateKey(nn,!1,["sign"]),t=await r.exportKey("jwk",e.publicKey);await S(_e,e.privateKey),await S(Ee,t)}function Tt(r){return wt(cn(r))}function an(r){return new TextEncoder().encode(r)}function wt(r){return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+/g,"")}function cn(r){return encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,(t,s)=>String.fromCharCode(parseInt(s,16)))}function ln(r){let e="";return r.forEach(t=>{e+=String.fromCharCode(t)}),wt(e)}var St=Symbol("Payload pre-processed by Magic SDK");function xt(r){return Object.defineProperty(r,St,{value:!0,enumerable:!1}),r}function un(r){return!!r[St]}function F(r){return un(r)||(r.jsonrpc=r.jsonrpc??"2.0",r.id=Le(),r.method=r.method??"noop",r.params=r.params??[],xt(r)),r}function p(r,e=[]){return xt({params:e,method:r,jsonrpc:"2.0",id:Le()})}var K=class r{_jsonrpc;_id;_result;_error;constructor(e){e instanceof r?(this._jsonrpc=e.payload.jsonrpc,this._id=e.payload.id,this._result=e.payload.result,this._error=e.payload.error):ct(e)?(this._jsonrpc=e.jsonrpc,this._id=e.id,this._result=e.result,this._error=e.error):(this._jsonrpc=e.jsonrpc,this._id=e.id,this._result=void 0,this._error=void 0)}applyError(e){return this._error=e,this}applyResult(e){return this._result=e,this}get hasError(){return this._error?.code===dn.DpopInvalidated&&bt(),typeof this._error<"u"&&this._error!==null}get hasResult(){return typeof this._result<"u"}get payload(){return{jsonrpc:this._jsonrpc,id:this._id,result:this._result,error:this._error}}};import{UserEventsEmit as hn,UserEventsOnReceived as En}from"@magic-sdk/types";var Ct=sr(Nt()),De=class extends Ct.default{};function ge(){let r=new De;return{emitter:r,createChainingEmitterMethod:(s,n)=>(...o)=>(r[s].apply(r,o),n),createBoundEmitterMethod:s=>(...n)=>r[s].apply(r,n)}}var At=Symbol("isPromiEvent");function $t(r){return!!r[At]}function b(r){let e=qe(r),{createBoundEmitterMethod:t,createChainingEmitterMethod:s}=ge(),n=Symbol("Promise.then"),o=Symbol("Promise.catch"),i=Symbol("Promise.finally"),a=(l,u)=>(...P)=>{let w=u[l].apply(u,P);return c(w)},c=l=>Object.assign(l,{[At]:!0,[n]:l[n]||l.then,[o]:l[o]||l.catch,[i]:l[i]||l.finally,then:a(n,l),catch:a(o,l),finally:a(i,l),on:s("on",l),once:s("once",l),addListener:s("addListener",l),off:s("off",l),removeListener:s("removeListener",l),removeAllListeners:s("removeAllListeners",l),emit:t("emit"),eventNames:t("eventNames"),listeners:t("listeners"),listenerCount:t("listenerCount")}),d=c(e.then(l=>(d.emit("done",l),d.emit("settled"),l),l=>{throw d.emit("error",l),d.emit("settled"),l}));return d.on(En.ClosedByUser,()=>{d.emit(hn.ClosedByUser)}),d}function qe(r){return new Promise((e,t)=>{let s=r(e,t);Promise.resolve(s).catch(t)})}var f=class{constructor(e){this.sdk=e}get overlay(){return this.sdk.overlay}request(e){if(this.sdk.thirdPartyWallets.isConnected&&!Rn.includes(e.method))return b((i,a)=>{this.sdk.thirdPartyWallets.requestOverride(e).then(i).catch(a)});let t=this.overlay.post(fn.MAGIC_HANDLE_REQUEST,F(e)),s=b((o,i)=>{t.then(a=>{if(n(),a.hasError)i(new U(a.payload.error));else if(a.hasResult)o(a.payload.result);else throw mt()}).catch(a=>{n(),i(a)})}),n=this.overlay.on(gn.MAGIC_HANDLE_EVENT,o=>{let{response:i}=o.data;if(i.id===e.id&&i.result?.event){let{event:a,params:c=[]}=i.result;s.emit(a,...c)}});return s}createIntermediaryEvent(e,t){return n=>{let o=p(yn.IntermediaryEvent,[{payloadId:t,eventType:e,args:n}]);this.request(o)}}};function Lt(r,e){let[t]=r.split(".").map(Number);return t>=e}var vn={"magic-sdk":"v18.0.0","@magic-sdk/react-native":"v14.0.0","@magic-sdk/react-native-bare":"v19.0.0","@magic-sdk/react-native-expo":"v19.0.0"},Re=class extends f{loginWithMagicLink(e){let t=m.sdkName==="@magic-sdk/react-native"||m.sdkName==="@magic-sdk/react-native-bare"||m.sdkName==="@magic-sdk/react-native-expo";if(t&&Lt(m.version,19))throw new Error("loginWithMagicLink() is deprecated for this package, please utlize a passcode method like loginWithSMS or loginWithEmailOTP instead.");t&&Rt({method:"auth.loginWithMagicLink()",removalVersions:vn,useInstead:"auth.loginWithEmailOTP()"}).log();let{email:s,showUI:n=!0,redirectURI:o,overrides:i,lifespan:a}=e,c=p(this.sdk.testMode?x.LoginWithMagicLinkTestMode:x.LoginWithMagicLink,[{email:s,showUI:n,redirectURI:o,overrides:i,lifespan:a}]);return this.request(c)}loginWithSMS(e){let{phoneNumber:t,showUI:s=!0,lifespan:n}=e,o=p(this.sdk.testMode?x.LoginWithSmsTestMode:x.LoginWithSms,[{phoneNumber:t,showUI:s,lifespan:n}]),i=this.request(o);return!s&&i&&(i.on(ye.VerifySmsOtp,a=>{this.createIntermediaryEvent(ye.VerifySmsOtp,o.id)(a)}),i.on(ye.Cancel,()=>{this.createIntermediaryEvent(ye.Cancel,o.id)()})),i}loginWithEmailOTP(e){let{email:t,showUI:s,deviceCheckUI:n,overrides:o,lifespan:i}=e,a=p(this.sdk.testMode?x.LoginWithEmailOTPTestMode:x.LoginWithEmailOTP,[{email:t,showUI:s,deviceCheckUI:n,overrides:o,lifespan:i}]),c=this.request(a);return!n&&c&&c.on(Ot.Retry,()=>{this.createIntermediaryEvent(Ot.Retry,a.id)()}),!s&&c&&(c.on(N.VerifyEmailOtp,d=>{this.createIntermediaryEvent(N.VerifyEmailOtp,a.id)(d)}),c.on(N.VerifyMFACode,d=>{this.createIntermediaryEvent(N.VerifyMFACode,a.id)(d)}),c.on(N.LostDevice,()=>{this.createIntermediaryEvent(N.LostDevice,a.id)()}),c.on(N.VerifyRecoveryCode,d=>{this.createIntermediaryEvent(N.VerifyRecoveryCode,a.id)(d)}),c.on(N.Cancel,()=>{this.createIntermediaryEvent(N.Cancel,a.id)()})),c}loginWithCredential(e){let{credentialOrQueryString:t,lifespan:s}=e||{},n=t??"";if(!t&&m.platform==="web"){n=window.location.search;let i=window.location.origin+window.location.pathname;window.history.replaceState(null,"",i)}let o=p(this.sdk.testMode?x.LoginWithCredentialTestMode:x.LoginWithCredential,[n,s]);return this.request(o)}setAuthorizationToken(e){let t=p(x.SetAuthorizationToken,[{jwt:e}]);return this.request(t)}updateEmailWithUI(e){let{email:t,showUI:s=!0}=e,n=p(this.sdk.testMode?x.UpdateEmailTestMode:x.UpdateEmail,[{email:t,showUI:s}]),o=this.request(n);return s||(o.on(_.Retry,()=>{this.createIntermediaryEvent(_.Retry,n.id)()}),o.on(_.Cancel,()=>{this.createIntermediaryEvent(_.Cancel,n.id)()}),o.on(_.VerifyEmailOtp,i=>{this.createIntermediaryEvent(_.VerifyEmailOtp,n.id)(i)}),o.on(_.VerifyMFACode,i=>{this.createIntermediaryEvent(_.VerifyMFACode,n.id)(i)}),o.on(j.RetryWithNewEmail,i=>{this.createIntermediaryEvent(j.RetryWithNewEmail,n.id)(i)}),o.on(j.Cancel,()=>{this.createIntermediaryEvent(j.Cancel,n.id)()}),o.on(j.VerifyEmailOtp,i=>{this.createIntermediaryEvent(j.VerifyEmailOtp,n.id)(i)})),o}};import{MagicPayloadMethod as g,EnableMFAEventEmit as Te,DisableMFAEventEmit as V,RecencyCheckEventEmit as Ut,RecoveryFactorEventEmit as k,RecoverAccountEventEmit as D,UpdateEmailEventEmit as B}from"@magic-sdk/types";var Ue="ds",Fe="ek",We="iv",Je="AES-GCM",Tn=256;async function ve(){let r=[];await Oe((e,t,s)=>{t.startsWith(`${Ue}_`)&&r.push(t)});for(let e of r)await A(e)}function _t(r){let e="",t=new Uint8Array(r),s=t.byteLength;for(let n=0;n<s;n++)e+=String.fromCharCode(t[n]);return window.btoa(e)}function kt(r){let e=window.atob(r),t=e.length,s=new Uint8Array(t);for(let n=0;n<t;n++)s[n]=e.charCodeAt(n);return s.buffer}async function In(){if(!ne()){console.info("webcrypto is not supported");return}let{crypto:r}=window,e=await R(We);return e||r.getRandomValues(new Uint8Array(12))}async function bn(){if(!ne()){console.info("webcrypto is not supported");return}let{subtle:r}=window.crypto,e=await R(Fe);return e||await r.generateKey({name:Je,length:Tn},!1,["encrypt","decrypt"])}async function Dt(r,e){let t=await In(),s=await bn();if(!t||!s||!r)return;let n=kt(r),{subtle:o}=window.crypto,i=await o.encrypt({name:Je,iv:t},s,n),a=_t(i);await S(`${Ue}_${e}`,a),await S(Fe,s),await S(We,t)}async function qt(r){let e=await R(`${Ue}_${r}`),t=await R(We),s=await R(Fe);if(!t||!e||!s||!ne())return;let{subtle:n}=window.crypto,o=await n.decrypt({name:Je,iv:t},s,kt(e));return _t(o)}function Ge(r,e){return e?new URL(r,e):new URL(r)}var Ie=class extends f{getIdToken(e){let t=p(this.sdk.testMode?g.GetIdTokenTestMode:g.GetIdToken,[e]);return this.request(t)}generateIdToken(e){let t=p(this.sdk.testMode?g.GenerateIdTokenTestMode:g.GenerateIdToken,[e]);return this.request(t)}getInfo(){let e=p(g.GetInfo,[]);return this.request(e)}isLoggedIn(){return b(async(e,t)=>{try{let s=!1;this.sdk.useStorageCache&&(s=await R(this.localForageIsLoggedInKey)==="true",s&&e(!0));let n=p(this.sdk.testMode?g.IsLoggedInTestMode:g.IsLoggedIn),o=await this.request(n);this.sdk.useStorageCache&&(o?S(this.localForageIsLoggedInKey,!0):A(this.localForageIsLoggedInKey),s&&!o&&this.emitUserLoggedOut(!0)),e(o)}catch(s){t(s)}})}logout(){return A(this.localForageIsLoggedInKey),ve(),b(async(e,t)=>{try{let s=p(this.sdk.testMode?g.LogoutTestMode:g.Logout),n=await this.request(s);this.sdk.useStorageCache&&this.emitUserLoggedOut(n),e(n)}catch(s){t(s)}})}requestInfoWithUI(e){let t=p(g.RequestUserInfoWithUI,e?[e]:[]);return this.request(t)}showSettings(e){let{showUI:t=!0}=e||{},s=p(this.sdk.testMode?g.UserSettingsTestMode:g.UserSettings,[e]),n=this.request(s);return!t&&n&&(n.on(k.SendNewPhoneNumber,o=>{this.createIntermediaryEvent(k.SendNewPhoneNumber,s.id)(o)}),n.on(k.SendOtpCode,o=>{this.createIntermediaryEvent(k.SendOtpCode,s.id)(o)}),n.on(k.StartEditPhoneNumber,()=>{this.createIntermediaryEvent(k.StartEditPhoneNumber,s.id)()}),n.on(k.Cancel,()=>{this.createIntermediaryEvent(k.Cancel,s.id)()}),n.on(Ut.VerifyEmailOtp,o=>{this.createIntermediaryEvent(Ut.VerifyEmailOtp,s.id)(o)})),n}recoverAccount(e){let{email:t,showUI:s}=e,n=p(this.sdk.testMode?g.RecoverAccountTestMode:g.RecoverAccount,[{email:t,showUI:s}]),o=this.request(n);return!s&&o&&(o.on(D.Cancel,()=>{this.createIntermediaryEvent(D.Cancel,n.id)()}),o.on(D.ResendSms,()=>{this.createIntermediaryEvent(D.ResendSms,n.id)()}),o.on(D.VerifyOtp,i=>{this.createIntermediaryEvent(D.VerifyOtp,n.id)(i)}),o.on(D.UpdateEmail,i=>{this.createIntermediaryEvent(D.UpdateEmail,n.id)(i)}),o.on(B.Cancel,()=>{this.createIntermediaryEvent(B.Cancel,n.id)()}),o.on(B.RetryWithNewEmail,i=>{this.createIntermediaryEvent(B.RetryWithNewEmail,n.id)(i)}),o.on(B.VerifyEmailOtp,i=>{this.createIntermediaryEvent(B.VerifyEmailOtp,n.id)(i)})),o}revealPrivateKey(){let e=p(g.RevealPK);return this.request(e)}onUserLoggedOut(e){this.userLoggedOutCallbacks.push(e)}enableMFA(e){let{showUI:t=!0}=e,s=p(g.EnableMFA,[{showUI:t}]),n=this.request(s);return!t&&n&&(n.on(Te.VerifyMFACode,o=>{this.createIntermediaryEvent(Te.VerifyMFACode,s.id)(o)}),n.on(Te.Cancel,()=>{this.createIntermediaryEvent(Te.Cancel,s.id)()})),n}disableMFA(e){let{showUI:t=!0}=e,s=p(g.DisableMFA,[{showUI:t}]),n=this.request(s);return!t&&n&&(n.on(V.VerifyMFACode,o=>{this.createIntermediaryEvent(V.VerifyMFACode,s.id)(o)}),n.on(V.LostDevice,o=>{this.createIntermediaryEvent(V.LostDevice,s.id)(o)}),n.on(V.Cancel,()=>{this.createIntermediaryEvent(V.Cancel,s.id)()})),n}emitUserLoggedOut(e){this.userLoggedOutCallbacks.forEach(t=>{t(e)})}localForageIsLoggedInKey="magic_auth_is_logged_in";userLoggedOutCallbacks=[]};import{MagicPayloadMethod as q}from"@magic-sdk/types";var be=class extends f{connectWithUI(e){let t=b(async(s,n)=>{try{let o=p(q.Login,[{enabledWallets:this.sdk.thirdPartyWallets.enabledWallets,...e}]),i=this.request(o);this.sdk.thirdPartyWallets.eventListeners.forEach(({event:c,callback:d})=>{i.on(c,()=>d(o.id))}),i.on("id-token-created",c=>{t.emit("id-token-created",c)});let a=await i;a.error&&n(a),s(a)}catch(o){n(o)}});return t}showUI(e){return this.request(p(q.ShowUI,[e]))}showAddress(){return this.request(p(q.ShowAddress))}showSendTokensUI(){return this.request(p(q.ShowSendTokensUI))}showOnRamp(){return this.request(p(q.ShowOnRamp))}showNFTs(){return this.request(p(q.ShowNFTs))}showBalances(){return this.request(p(q.ShowBalances))}sendGaslessTransaction(e,t){return this.request(p(q.SendGaslessTransaction,[e,t]))}};import{LocalStorageKeys as W,MagicPayloadMethod as Pe}from"@magic-sdk/types";var we=class extends f{eventListeners=[];enabledWallets={};isConnected=!1;resetThirdPartyWalletState(){localStorage.removeItem(W.PROVIDER),localStorage.removeItem(W.ADDRESS),localStorage.removeItem(W.CHAIN_ID),this.isConnected=!1}requestOverride(e){if(e.method===Pe.Login)return this.resetThirdPartyWalletState(),super.request(e);if(e.method===Pe.GetInfo)return this.getInfo(e);if(e.method===Pe.IsLoggedIn)return this.isLoggedIn(e);if(e.method===Pe.Logout)return this.logout(e);switch(localStorage.getItem(W.PROVIDER)){case"web3modal":return this.web3modalRequest(e);default:return this.resetThirdPartyWalletState(),super.request(e)}}isLoggedIn(e){switch(localStorage.getItem(W.PROVIDER)){case"web3modal":return this.web3modalIsLoggedIn();default:return this.resetThirdPartyWalletState(),super.request(e)}}getInfo(e){switch(localStorage.getItem(W.PROVIDER)){case"web3modal":return this.web3modalGetInfo();default:return this.resetThirdPartyWalletState(),super.request(e)}}logout(e){let t=localStorage.getItem(W.PROVIDER);switch(this.resetThirdPartyWalletState(),t){case"web3modal":return this.web3modalLogout();default:return super.request(e)}}web3modalRequest(e){return b((t,s)=>{this.sdk.web3modal.modal.getWalletProvider().request(e).then(t).catch(s)})}web3modalIsLoggedIn(){return b(e=>{let t=this.sdk.web3modal.modal.getStatus();if(t==="connected"&&e(!0),t==="disconnected"&&(this.resetThirdPartyWalletState(),e(!1)),t==="reconnecting"){let s=this.sdk.web3modal.modal.subscribeProvider(({status:n})=>{n==="connected"&&(s(),e(!0)),n==="disconnected"&&(s(),this.resetThirdPartyWalletState(),e(!1))})}})}formatWeb3modalGetInfoResponse(){let e=this.sdk.web3modal.modal.getWalletInfo()?.name,t=this.sdk.web3modal.modal.getAddress();return{publicAddress:t,email:null,issuer:`did:ethr:${t}`,phoneNumber:null,isMfaEnabled:!1,recoveryFactors:[],walletType:e||"web3modal",firstLoginAt:null}}web3modalGetInfo(){return b((e,t)=>{let s=this.sdk.web3modal.modal.getStatus();if(s==="connected"&&e(this.formatWeb3modalGetInfoResponse()),s==="disconnected"&&(this.resetThirdPartyWalletState(),t("Magic RPC Error: [-32603] Internal error: User denied account access.")),s==="reconnecting"){let n=this.sdk.web3modal.modal.subscribeProvider(({status:o})=>{o==="connected"&&(n(),e(this.formatWeb3modalGetInfoResponse())),o==="disconnected"&&(n(),this.resetThirdPartyWalletState(),t("Magic RPC Error: [-32603] Internal error: User denied account access."))})}})}web3modalLogout(){return b(async e=>{try{await this.sdk.web3modal.modal.disconnect()}catch(t){console.error(t)}e(!0)})}};import{MagicOutgoingWindowMessage as Ft,MagicPayloadMethod as Pn}from"@magic-sdk/types";var{createBoundEmitterMethod:Se,createChainingEmitterMethod:H}=ge(),xe=class extends f{isMagic=!0;sendAsync(e,t){if(!t)throw ft({procedure:"Magic.rpcProvider.sendAsync",argument:1,expected:"function",received:t===null?"null":typeof t});if(Array.isArray(e))this.overlay.post(Ft.MAGIC_HANDLE_REQUEST,e.map(s=>{let n=F(s);return this.prefixPayloadMethodForTestMode(n),n})).then(s=>{t(null,s.map(n=>({...n.payload,error:n.hasError?new U(n.payload.error):null})))});else{let s=F(e);this.prefixPayloadMethodForTestMode(s),this.overlay.post(Ft.MAGIC_HANDLE_REQUEST,s).then(n=>{t(n.hasError?new U(n.payload.error):null,n.payload)})}}send(e,t){if(typeof e=="string"){let n=p(e,Array.isArray(t)?t:[]);return this.request(n)}if(Array.isArray(e)||t){this.sendAsync(e,t);return}let s=gt();return s.log(),new K(e).applyError({code:-32603,message:s.rawMessage}).payload}enable(){let e=p(Pn.Login);return this.request(e)}request(e){return this.prefixPayloadMethodForTestMode(e),super.request(e)}prefixPayloadMethodForTestMode(e){let t="testMode/eth/";this.sdk.testMode&&(e.method=`${t}${e.method}`)}on=H("on",this);once=H("once",this);addListener=H("addListener",this);off=H("off",this);removeListener=H("removeListener",this);removeAllListeners=H("removeAllListeners",this);emit=Se("emit");eventNames=Se("eventNames");listeners=Se("listeners");listenerCount=Se("listenerCount")};var Wt=["request","overlay","sdk"];function wn(r){let e=Object.getPrototypeOf(r),t=[e];for(;e!==f.prototype;)e=Object.getPrototypeOf(e),t.push(e);return t}var Ke=class extends f{compat;__sdk_access_field_descriptors__=new Map;__is_initialized__=!1;utils={createPromiEvent:b,isPromiEvent:$t,encodeJSON:le,decodeJSON:at,createJsonRpcRequestPayload:p,standardizeJsonRpcRequestPayload:F,storage:he};constructor(){super(void 0);let e=[this,...wn(this)];Wt.forEach(t=>{let s=e.map(a=>Object.getOwnPropertyDescriptor(a,t)),n=s.findIndex(a=>!!a),o=n>0,i=s[n];i&&(this.__sdk_access_field_descriptors__.set(t,{descriptor:i,isPrototypeField:o}),Object.defineProperty(this,t,{configurable:!0,get:()=>{throw ht(t)}}))})}init(e){this.__is_initialized__||(Wt.forEach(t=>{if(this.__sdk_access_field_descriptors__.has(t)){let{descriptor:s,isPrototypeField:n}=this.__sdk_access_field_descriptors__.get(t);n?delete this[t]:Object.defineProperty(this,t,s)}}),this.sdk=e,this.__is_initialized__=!0)}createDeprecationWarning(e){let{method:t,removalVersion:s,useInstead:n}=e,o=n?` Use \`${n}\` instead.`:"",i=`\`${t}\` will be removed from this Extension in version \`${s}\`.${o}`;return new re(this,"DEPRECATION_NOTICE",i)}createWarning(e,t){return new re(this,e,t)}createError(e,t,s){return new ue(this,e,t,s)}},je=class extends Ke{},X=class{static Internal=je};import{MagicPayloadMethod as Ve,NftCheckoutIntermediaryEvents as Me}from"@magic-sdk/types";var Ne=class extends f{purchase(e){let t=p(Ve.NFTPurchase,[e]);return this.request(t)}checkout(e){let t=this.sdk.thirdPartyWallets.isConnected,s=p(Ve.NFTCheckout,[{...e,walletProvider:t?"web3modal":"magic"}]),n=this.request(s);return t&&(n.on(Me.Initiated,async o=>{try{let i=await this.request({method:"eth_sendTransaction",params:[o]});this.createIntermediaryEvent(Me.Success,s.id)(i)}catch{this.createIntermediaryEvent(Me.Failure,s.id)()}}),n.on(Me.Disconnect,()=>{this.sdk.thirdPartyWallets.resetThirdPartyWalletState(),n.emit("disconnect")})),n}transfer(e){let t=p(Ve.NFTTransfer,[e]);return this.request(t)}};function Jt(r){return r.compat&&r.compat[m.sdkName]!=null?typeof r.compat[m.sdkName]=="string"?ot(it(m.version),r.compat[m.sdkName]):!!r.compat[m.sdkName]:!0}function Sn(r,e,t){return!e&&!t?`${r}_eth_mainnet`:t?`${r}_${JSON.stringify(t)}`:e?typeof e=="string"?`${r}_eth_${e}`:`${r}_${e.rpcUrl}_${e.chainId}_${e.chainType}`:`${r}_unknown`}function xn(r){let e=r?.extensions??[],t={},s=[];if(Array.isArray(e)?e.forEach(n=>{Jt(n)?(n.init(this),n.name&&(this[n.name]=n),n instanceof X.Internal&&(te(n.config)||(t[n.name]=n.config))):s.push(n)}):Object.keys(e).forEach(n=>{if(Jt(e[n])){e[n].init(this);let o=e[n];this[n]=o,o instanceof X.Internal&&(te(o.config)||(t[e[n].name]=o.config))}else s.push(e[n])}),s.length)throw Et(s);return t}var Be=class r{constructor(e,t){this.apiKey=e;if(!e)throw ut();m.platform==="react-native"&&t?.endpoint&&yt().log();let{defaultEndpoint:s,version:n}=m;this.testMode=!!t?.testMode,this.useStorageCache=!!t?.useStorageCache,this.endpoint=Ge(t?.endpoint??s).origin,this.auth=new Re(this),this.user=new Ie(this),this.wallet=new be(this),this.nft=new Ne(this),this.thirdPartyWallets=new we(this),this.rpcProvider=new xe(this);let o=xn.call(this,t);this.parameters=le({API_KEY:this.apiKey,DOMAIN_ORIGIN:window.location?window.location.origin:"",ETH_NETWORK:t?.network,host:Ge(this.endpoint).host,sdk:dt[m.sdkName],version:n,ext:te(o)?void 0:o,locale:t?.locale||"en_US",...m.bundleId?{bundleId:m.bundleId}:{},meta:t?.meta}),this.networkHash=Sn(this.apiKey,t?.network,te(o)?void 0:o),t?.deferPreload||this.preload()}static __overlays__=new Map;endpoint;parameters;networkHash;testMode;useStorageCache;auth;user;wallet;nft;thirdPartyWallets;rpcProvider;get overlay(){if(!r.__overlays__.has(this.parameters)){let e=new m.ViewController(this.endpoint,this.parameters,this.networkHash);e.init(),r.__overlays__.set(this.parameters,e)}return r.__overlays__.get(this.parameters)}async preload(){await this.overlay.waitForReady()}};import{MagicIncomingWindowMessage as oe,MagicOutgoingWindowMessage as Nn,SDKWarningCode as Cn}from"@magic-sdk/types";function Mn(r,e){return e&&Array.isArray(r)?r.find(t=>t.id===e):r}function Gt(r,e){let t=e.data.response?.id,s=Mn(r,t);if(t&&s){let n=new K(s).applyResult(e.data.response.result).applyError(e.data.response.error);return{id:t,response:n}}return{}}async function Kt(r,e,t){let s=await R("rt"),n;if(m.platform==="web")try{n=await R("jwt")??await Pt()}catch(a){console.error("webcrypto error",a)}let o={msgType:r,payload:e};n&&(o.jwt=n),n&&s&&(o.rt=s);let i=await qt(t);return i&&(o.deviceShare=i),o}async function jt(r){r.data.rt&&await S("rt",r.data.rt)}function Vt(r,e){let t=null;return function(...s){t&&clearTimeout(t),t=setTimeout(()=>{r(...s)},e)}}var An=1e3,Ht=60*An,Bt=5*Ht,$n=60*Ht,He=class{constructor(e,t,s){this.endpoint=e;this.parameters=t;this.networkHash=s;this.listen()}isReadyForRequest=!1;messageHandlers=new Set;isConnectedToInternet=!0;lastPongTime=null;heartbeatIntervalTimer=null;heartbeatDebounce=Vt(()=>{this.endpoint==="https://auth.magic.link/"&&this.heartBeatCheck()},$n);async post(e,t){return qe(async(s,n)=>{if(!this.isConnectedToInternet){let l=pt();n(l)}await this.checkRelayerExistsInDOM()||(this.isReadyForRequest=!1,await this.reloadRelayer()),this.isReadyForRequest||await this.waitForReady();let o=[],i=Array.isArray(t)?t.map(l=>l.id):[],a=await Kt(`${e}-${this.parameters}`,t,this.networkHash);await this._post(a);let c=l=>u=>{let{id:P,response:w}=Gt(t,u);if(jt(u),w?.payload.error?.message==="User denied account access.")ve();else if(u.data.deviceShare){let{deviceShare:Xt}=u.data;Dt(Xt,this.networkHash)}P&&w&&Array.isArray(t)&&i.includes(P)?(o.push(w),o.length===t.length&&(l(),s(o))):P&&w&&!Array.isArray(t)&&P===t.id&&(l(),s(w))},d=this.on(oe.MAGIC_HANDLE_RESPONSE,c(()=>d()))})}on(e,t){let s=t.bind(window),n=o=>{o.data.msgType===`${e}-${this.parameters}`&&s(o)};return this.messageHandlers.add(n),()=>this.messageHandlers.delete(n)}waitForReady(){return new Promise(e=>{let t=this.on(oe.MAGIC_OVERLAY_READY,()=>{this.isReadyForRequest=!0,e(),t()})})}listen(){this.on(oe.MAGIC_HIDE_OVERLAY,()=>{this.hideOverlay()}),this.on(oe.MAGIC_SHOW_OVERLAY,()=>{this.showOverlay()}),this.on(oe.MAGIC_SEND_PRODUCT_ANNOUNCEMENT,e=>{e.data.response.result.product_announcement&&new L(Cn.ProductAnnouncement,e.data.response.result.product_announcement).log()})}heartBeatCheck(){let e=!0,t=async()=>{let s={msgType:`${Nn.MAGIC_PING}-${this.parameters}`,payload:[]};await this._post(s)};this.heartbeatIntervalTimer=setInterval(async()=>{if(this.lastPongTime){if(Date.now()-this.lastPongTime>Bt*2){this.reloadRelayer(),e=!0;return}}else if(!e){this.reloadRelayer(),e=!0;return}await t(),e=!1},Bt)}stopHeartBeat(){this.heartbeatDebounce(),this.lastPongTime=null,this.heartbeatIntervalTimer&&(clearInterval(this.heartbeatIntervalTimer),this.heartbeatIntervalTimer=null)}};export{X as Extension,ue as MagicExtensionError,re as MagicExtensionWarning,U as MagicRPCError,$ as MagicSDKError,L as MagicSDKWarning,Be as SDKBase,_e as STORE_KEY_PRIVATE_KEY,Ee as STORE_KEY_PUBLIC_JWK,De as TypedEmitter,He as ViewController,bt as clearKeys,Rt as createDeprecationWarning,Bn as createDuplicateIframeWarning,ht as createExtensionNotInitializedError,Et as createIncompatibleExtensionsError,ft as createInvalidArgumentError,Pt as createJwt,mt as createMalformedResponseError,ut as createMissingApiKeyError,pt as createModalNotReadyError,b as createPromiEvent,qe as createPromise,yt as createReactNativeEndpointConfigurationWarning,Hr as createSDK,gt as createSynchronousWeb3MethodWarning,ge as createTypedEmitter,Ge as createURL,at as decodeJSON,le as encodeJSON,Le as getPayloadId,te as isEmpty,lt as isJsonRpcErrorCode,Un as isJsonRpcRequestPayload,ct as isJsonRpcResponsePayload,Fn as isMagicPayloadMethod,Lt as isMajorVersionAtLeast,$t as isPromiEvent,ne as isWebCryptoSupported,he as storage,vt as uuid};
//# sourceMappingURL=index.js.map
