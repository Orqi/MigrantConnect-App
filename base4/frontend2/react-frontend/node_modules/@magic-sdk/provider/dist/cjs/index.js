"use strict";var Gt=Object.create;var ae=Object.defineProperty;var Kt=Object.getOwnPropertyDescriptor;var jt=Object.getOwnPropertyNames;var Vt=Object.getPrototypeOf,Bt=Object.prototype.hasOwnProperty;var Ht=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),st=(r,e)=>{for(var t in e)ae(r,t,{get:e[t],enumerable:!0})},ot=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of jt(e))!Bt.call(r,n)&&n!==t&&ae(r,n,{get:()=>e[n],enumerable:!(s=Kt(e,n))||s.enumerable});return r};var Xt=(r,e,t)=>(t=r!=null?Gt(Vt(r)):{},ot(e||!r||!r.__esModule?ae(t,"default",{value:r,enumerable:!0}):t,r)),zt=r=>ot(ae({},"__esModule",{value:!0}),r);var xt=Ht((Un,Xe)=>{"use strict";var tn=Object.prototype.hasOwnProperty,P="~";function se(){}Object.create&&(se.prototype=Object.create(null),new se().__proto__||(P=!1));function rn(r,e,t){this.fn=r,this.context=e,this.once=t||!1}function St(r,e,t,s,n){if(typeof t!="function")throw new TypeError("The listener must be a function");var o=new rn(t,s||r,n),i=P?P+e:e;return r._events[i]?r._events[i].fn?r._events[i]=[r._events[i],o]:r._events[i].push(o):(r._events[i]=o,r._eventsCount++),r}function fe(r,e){--r._eventsCount===0?r._events=new se:delete r._events[e]}function T(){this._events=new se,this._eventsCount=0}T.prototype.eventNames=function(){var e=[],t,s;if(this._eventsCount===0)return e;for(s in t=this._events)tn.call(t,s)&&e.push(P?s.slice(1):s);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};T.prototype.listeners=function(e){var t=P?P+e:e,s=this._events[t];if(!s)return[];if(s.fn)return[s.fn];for(var n=0,o=s.length,i=new Array(o);n<o;n++)i[n]=s[n].fn;return i};T.prototype.listenerCount=function(e){var t=P?P+e:e,s=this._events[t];return s?s.fn?1:s.length:0};T.prototype.emit=function(e,t,s,n,o,i){var a=P?P+e:e;if(!this._events[a])return!1;var c=this._events[a],u=arguments.length,d,m;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,s),!0;case 4:return c.fn.call(c.context,t,s,n),!0;case 5:return c.fn.call(c.context,t,s,n,o),!0;case 6:return c.fn.call(c.context,t,s,n,o,i),!0}for(m=1,d=new Array(u-1);m<u;m++)d[m-1]=arguments[m];c.fn.apply(c.context,d)}else{var w=c.length,S;for(m=0;m<w;m++)switch(c[m].once&&this.removeListener(e,c[m].fn,void 0,!0),u){case 1:c[m].fn.call(c[m].context);break;case 2:c[m].fn.call(c[m].context,t);break;case 3:c[m].fn.call(c[m].context,t,s);break;case 4:c[m].fn.call(c[m].context,t,s,n);break;default:if(!d)for(S=1,d=new Array(u-1);S<u;S++)d[S-1]=arguments[S];c[m].fn.apply(c[m].context,d)}}return!0};T.prototype.on=function(e,t,s){return St(this,e,t,s,!1)};T.prototype.once=function(e,t,s){return St(this,e,t,s,!0)};T.prototype.removeListener=function(e,t,s,n){var o=P?P+e:e;if(!this._events[o])return this;if(!t)return fe(this,o),this;var i=this._events[o];if(i.fn)i.fn===t&&(!n||i.once)&&(!s||i.context===s)&&fe(this,o);else{for(var a=0,c=[],u=i.length;a<u;a++)(i[a].fn!==t||n&&!i[a].once||s&&i[a].context!==s)&&c.push(i[a]);c.length?this._events[o]=c.length===1?c[0]:c:fe(this,o)}return this};T.prototype.removeAllListeners=function(e){var t;return e?(t=P?P+e:e,this._events[t]&&fe(this,t)):(this._events=new se,this._eventsCount=0),this};T.prototype.off=T.prototype.removeListener;T.prototype.addListener=T.prototype.on;T.prefixed=P;T.EventEmitter=T;typeof Xe<"u"&&(Xe.exports=T)});var hn={};st(hn,{Extension:()=>J,MagicExtensionError:()=>te,MagicExtensionWarning:()=>j,MagicRPCError:()=>q,MagicSDKError:()=>L,MagicSDKWarning:()=>O,SDKBase:()=>Ne,STORE_KEY_PRIVATE_KEY:()=>Ee,STORE_KEY_PUBLIC_JWK:()=>ne,TypedEmitter:()=>ge,ViewController:()=>Ce,clearKeys:()=>Be,createDeprecationWarning:()=>Ke,createDuplicateIframeWarning:()=>Fr,createExtensionNotInitializedError:()=>Ue,createIncompatibleExtensionsError:()=>Fe,createInvalidArgumentError:()=>We,createJwt:()=>He,createMalformedResponseError:()=>qe,createMissingApiKeyError:()=>ke,createModalNotReadyError:()=>De,createPromiEvent:()=>I,createPromise:()=>Re,createReactNativeEndpointConfigurationWarning:()=>Ge,createSDK:()=>yt,createSynchronousWeb3MethodWarning:()=>Je,createTypedEmitter:()=>oe,createURL:()=>Ie,decodeJSON:()=>Le,encodeJSON:()=>ee,getPayloadId:()=>me,isEmpty:()=>K,isJsonRpcErrorCode:()=>_e,isJsonRpcRequestPayload:()=>qr,isJsonRpcResponsePayload:()=>Oe,isMagicPayloadMethod:()=>Ur,isMajorVersionAtLeast:()=>Ye,isPromiEvent:()=>ze,isWebCryptoSupported:()=>V,storage:()=>re,uuid:()=>Ve});module.exports=zt(hn);function Yt(r){let e={exports:{}};return r(e,e.exports),e.exports}var Qt=Number.MAX_SAFE_INTEGER||9007199254740991;var $e={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:Qt,MAX_SAFE_COMPONENT_LENGTH:16},Zt=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{},f=Zt,Z=Yt(function(r,e){let{MAX_SAFE_COMPONENT_LENGTH:t}=$e,s=(e=r.exports={}).re=[],n=e.src=[],o=e.t={},i=0,a=(c,u,d)=>{let m=i++;f(m,u),o[c]=m,n[m]=u,s[m]=new RegExp(u,d?"g":void 0)};a("NUMERICIDENTIFIER","0|[1-9]\\d*"),a("NUMERICIDENTIFIERLOOSE","[0-9]+"),a("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),a("MAINVERSION",`(${n[o.NUMERICIDENTIFIER]})\\.(${n[o.NUMERICIDENTIFIER]})\\.(${n[o.NUMERICIDENTIFIER]})`),a("MAINVERSIONLOOSE",`(${n[o.NUMERICIDENTIFIERLOOSE]})\\.(${n[o.NUMERICIDENTIFIERLOOSE]})\\.(${n[o.NUMERICIDENTIFIERLOOSE]})`),a("PRERELEASEIDENTIFIER",`(?:${n[o.NUMERICIDENTIFIER]}|${n[o.NONNUMERICIDENTIFIER]})`),a("PRERELEASEIDENTIFIERLOOSE",`(?:${n[o.NUMERICIDENTIFIERLOOSE]}|${n[o.NONNUMERICIDENTIFIER]})`),a("PRERELEASE",`(?:-(${n[o.PRERELEASEIDENTIFIER]}(?:\\.${n[o.PRERELEASEIDENTIFIER]})*))`),a("PRERELEASELOOSE",`(?:-?(${n[o.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${n[o.PRERELEASEIDENTIFIERLOOSE]})*))`),a("BUILDIDENTIFIER","[0-9A-Za-z-]+"),a("BUILD",`(?:\\+(${n[o.BUILDIDENTIFIER]}(?:\\.${n[o.BUILDIDENTIFIER]})*))`),a("FULLPLAIN",`v?${n[o.MAINVERSION]}${n[o.PRERELEASE]}?${n[o.BUILD]}?`),a("FULL",`^${n[o.FULLPLAIN]}$`),a("LOOSEPLAIN",`[v=\\s]*${n[o.MAINVERSIONLOOSE]}${n[o.PRERELEASELOOSE]}?${n[o.BUILD]}?`),a("LOOSE",`^${n[o.LOOSEPLAIN]}$`),a("GTLT","((?:<|>)?=?)"),a("XRANGEIDENTIFIERLOOSE",`${n[o.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),a("XRANGEIDENTIFIER",`${n[o.NUMERICIDENTIFIER]}|x|X|\\*`),a("XRANGEPLAIN",`[v=\\s]*(${n[o.XRANGEIDENTIFIER]})(?:\\.(${n[o.XRANGEIDENTIFIER]})(?:\\.(${n[o.XRANGEIDENTIFIER]})(?:${n[o.PRERELEASE]})?${n[o.BUILD]}?)?)?`),a("XRANGEPLAINLOOSE",`[v=\\s]*(${n[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${n[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${n[o.XRANGEIDENTIFIERLOOSE]})(?:${n[o.PRERELEASELOOSE]})?${n[o.BUILD]}?)?)?`),a("XRANGE",`^${n[o.GTLT]}\\s*${n[o.XRANGEPLAIN]}$`),a("XRANGELOOSE",`^${n[o.GTLT]}\\s*${n[o.XRANGEPLAINLOOSE]}$`),a("COERCE",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?(?:$|[^\\d])`),a("COERCERTL",n[o.COERCE],!0),a("LONETILDE","(?:~>?)"),a("TILDETRIM",`(\\s*)${n[o.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",a("TILDE",`^${n[o.LONETILDE]}${n[o.XRANGEPLAIN]}$`),a("TILDELOOSE",`^${n[o.LONETILDE]}${n[o.XRANGEPLAINLOOSE]}$`),a("LONECARET","(?:\\^)"),a("CARETTRIM",`(\\s*)${n[o.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",a("CARET",`^${n[o.LONECARET]}${n[o.XRANGEPLAIN]}$`),a("CARETLOOSE",`^${n[o.LONECARET]}${n[o.XRANGEPLAINLOOSE]}$`),a("COMPARATORLOOSE",`^${n[o.GTLT]}\\s*(${n[o.LOOSEPLAIN]})$|^$`),a("COMPARATOR",`^${n[o.GTLT]}\\s*(${n[o.FULLPLAIN]})$|^$`),a("COMPARATORTRIM",`(\\s*)${n[o.GTLT]}\\s*(${n[o.LOOSEPLAIN]}|${n[o.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",a("HYPHENRANGE",`^\\s*(${n[o.XRANGEPLAIN]})\\s+-\\s+(${n[o.XRANGEPLAIN]})\\s*$`),a("HYPHENRANGELOOSE",`^\\s*(${n[o.XRANGEPLAINLOOSE]})\\s+-\\s+(${n[o.XRANGEPLAINLOOSE]})\\s*$`),a("STAR","(<|>)?=?\\s*\\*"),a("GTE0","^\\s*>=\\s*0.0.0\\s*$"),a("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")}),it=/^[0-9]+$/,Et=(r,e)=>{let t=it.test(r),s=it.test(e);return t&&s&&(r=+r,e=+e),r===e?0:t&&!s?-1:s&&!t?1:r<e?-1:1},er=(r,e)=>Et(e,r),tr={compareIdentifiers:Et,rcompareIdentifiers:er},{MAX_LENGTH:at,MAX_SAFE_INTEGER:ce}=$e,{re:ct,t:lt}=Z,{compareIdentifiers:X}=tr,C=class r{constructor(e,t){if(t&&typeof t=="object"||(t={loose:!!t,includePrerelease:!1}),e instanceof r){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid Version: ${e}`);if(e.length>at)throw new TypeError(`version is longer than ${at} characters`);f("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let s=e.trim().match(t.loose?ct[lt.LOOSE]:ct[lt.FULL]);if(!s)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+s[1],this.minor=+s[2],this.patch=+s[3],this.major>ce||this.major<0)throw new TypeError("Invalid major version");if(this.minor>ce||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>ce||this.patch<0)throw new TypeError("Invalid patch version");s[4]?this.prerelease=s[4].split(".").map(n=>{if(/^[0-9]+$/.test(n)){let o=+n;if(o>=0&&o<ce)return o}return n}):this.prerelease=[],this.build=s[5]?s[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(f("SemVer.compare",this.version,this.options,e),!(e instanceof r)){if(typeof e=="string"&&e===this.version)return 0;e=new r(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof r||(e=new r(e,this.options)),X(this.major,e.major)||X(this.minor,e.minor)||X(this.patch,e.patch)}comparePre(e){if(e instanceof r||(e=new r(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let s=this.prerelease[t],n=e.prerelease[t];if(f("prerelease compare",t,s,n),s===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(s===void 0)return-1;if(s!==n)return X(s,n)}while(++t)}compareBuild(e){e instanceof r||(e=new r(e,this.options));let t=0;do{let s=this.build[t],n=e.build[t];if(f("prerelease compare",t,s,n),s===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(s===void 0)return-1;if(s!==n)return X(s,n)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t),this.inc("pre",t);break;case"major":this.minor===0&&this.patch===0&&this.prerelease.length!==0||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":this.patch===0&&this.prerelease.length!==0||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);s===-1&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}},rr=(r,e,t)=>new C(r,t).compare(new C(e,t)),G=rr,nr=(r,e,t)=>G(r,e,t)===0,sr=nr,or=(r,e,t)=>G(r,e,t)!==0,ir=or,ar=(r,e,t)=>G(r,e,t)>0,cr=ar,lr=(r,e,t)=>G(r,e,t)>=0,dr=lr,ur=(r,e,t)=>G(r,e,t)<0,pr=ur,mr=(r,e,t)=>G(r,e,t)<=0,hr=mr,Er=(r,e,t,s)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return sr(r,t,s);case"!=":return ir(r,t,s);case">":return cr(r,t,s);case">=":return dr(r,t,s);case"<":return pr(r,t,s);case"<=":return hr(r,t,s);default:throw new TypeError(`Invalid operator: ${e}`)}},Ae=Er,z=Symbol("SemVer ANY"),Y=class r{static get ANY(){return z}constructor(e,t){if(t&&typeof t=="object"||(t={loose:!!t,includePrerelease:!1}),e instanceof r){if(e.loose===!!t.loose)return e;e=e.value}f("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===z?this.value="":this.value=this.operator+this.semver.version,f("comp",this)}parse(e){let t=this.options.loose?dt[ut.COMPARATORLOOSE]:dt[ut.COMPARATOR],s=e.match(t);if(!s)throw new TypeError(`Invalid comparator: ${e}`);this.operator=s[1]!==void 0?s[1]:"",this.operator==="="&&(this.operator=""),s[2]?this.semver=new C(s[2],this.options.loose):this.semver=z}toString(){return this.value}test(e){if(f("Comparator.test",e,this.options.loose),this.semver===z||e===z)return!0;if(typeof e=="string")try{e=new C(e,this.options)}catch{return!1}return Ae(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Comparator is required");if(t&&typeof t=="object"||(t={loose:!!t,includePrerelease:!1}),this.operator==="")return this.value===""||new Q(e.value,t).test(this.value);if(e.operator==="")return e.value===""||new Q(this.value,t).test(e.semver);let s=!(this.operator!==">="&&this.operator!==">"||e.operator!==">="&&e.operator!==">"),n=!(this.operator!=="<="&&this.operator!=="<"||e.operator!=="<="&&e.operator!=="<"),o=this.semver.version===e.semver.version,i=!(this.operator!==">="&&this.operator!=="<="||e.operator!==">="&&e.operator!=="<="),a=Ae(this.semver,"<",e.semver,t)&&(this.operator===">="||this.operator===">")&&(e.operator==="<="||e.operator==="<"),c=Ae(this.semver,">",e.semver,t)&&(this.operator==="<="||this.operator==="<")&&(e.operator===">="||e.operator===">");return s||n||o&&i||a||c}},{re:dt,t:ut}=Z,Q=class r{constructor(e,t){if(t&&typeof t=="object"||(t={loose:!!t,includePrerelease:!1}),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof Y)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(s=>this.parseRange(s.trim())).filter(s=>s.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);this.format()}format(){return this.range=this.set.map(e=>e.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(e){let{loose:t}=this.options;e=e.trim();let s=t?R[g.HYPHENRANGELOOSE]:R[g.HYPHENRANGE];e=e.replace(s,Mr(this.options.includePrerelease)),f("hyphen replace",e),e=e.replace(R[g.COMPARATORTRIM],fr),f("comparator trim",e,R[g.COMPARATORTRIM]),e=(e=(e=e.replace(R[g.TILDETRIM],gr)).replace(R[g.CARETTRIM],yr)).split(/\s+/).join(" ");let n=t?R[g.COMPARATORLOOSE]:R[g.COMPARATOR];return e.split(" ").map(o=>Rr(o,this.options)).join(" ").split(/\s+/).map(o=>xr(o,this.options)).filter(this.options.loose?o=>!!o.match(n):()=>!0).map(o=>new Y(o,this.options))}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some(s=>pt(s,t)&&e.set.some(n=>pt(n,t)&&s.every(o=>n.every(i=>o.intersects(i,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new C(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(Nr(this.set[t],e,this.options))return!0;return!1}},{re:R,t:g,comparatorTrimReplace:fr,tildeTrimReplace:gr,caretTrimReplace:yr}=Z,pt=(r,e)=>{let t=!0,s=r.slice(),n=s.pop();for(;t&&s.length;)t=s.every(o=>n.intersects(o,e)),n=s.pop();return t},Rr=(r,e)=>(f("comp",r,e),r=Ir(r,e),f("caret",r),r=vr(r,e),f("tildes",r),r=Pr(r,e),f("xrange",r),r=Sr(r,e),f("stars",r),r),b=r=>!r||r.toLowerCase()==="x"||r==="*",vr=(r,e)=>r.trim().split(/\s+/).map(t=>Tr(t,e)).join(" "),Tr=(r,e)=>{let t=e.loose?R[g.TILDELOOSE]:R[g.TILDE];return r.replace(t,(s,n,o,i,a)=>{let c;return f("tilde",r,s,n,o,i,a),b(n)?c="":b(o)?c=`>=${n}.0.0 <${+n+1}.0.0-0`:b(i)?c=`>=${n}.${o}.0 <${n}.${+o+1}.0-0`:a?(f("replaceTilde pr",a),c=`>=${n}.${o}.${i}-${a} <${n}.${+o+1}.0-0`):c=`>=${n}.${o}.${i} <${n}.${+o+1}.0-0`,f("tilde return",c),c})},Ir=(r,e)=>r.trim().split(/\s+/).map(t=>br(t,e)).join(" "),br=(r,e)=>{f("caret",r,e);let t=e.loose?R[g.CARETLOOSE]:R[g.CARET],s=e.includePrerelease?"-0":"";return r.replace(t,(n,o,i,a,c)=>{let u;return f("caret",r,n,o,i,a,c),b(o)?u="":b(i)?u=`>=${o}.0.0${s} <${+o+1}.0.0-0`:b(a)?u=o==="0"?`>=${o}.${i}.0${s} <${o}.${+i+1}.0-0`:`>=${o}.${i}.0${s} <${+o+1}.0.0-0`:c?(f("replaceCaret pr",c),u=o==="0"?i==="0"?`>=${o}.${i}.${a}-${c} <${o}.${i}.${+a+1}-0`:`>=${o}.${i}.${a}-${c} <${o}.${+i+1}.0-0`:`>=${o}.${i}.${a}-${c} <${+o+1}.0.0-0`):(f("no pr"),u=o==="0"?i==="0"?`>=${o}.${i}.${a}${s} <${o}.${i}.${+a+1}-0`:`>=${o}.${i}.${a}${s} <${o}.${+i+1}.0-0`:`>=${o}.${i}.${a} <${+o+1}.0.0-0`),f("caret return",u),u})},Pr=(r,e)=>(f("replaceXRanges",r,e),r.split(/\s+/).map(t=>wr(t,e)).join(" ")),wr=(r,e)=>{r=r.trim();let t=e.loose?R[g.XRANGELOOSE]:R[g.XRANGE];return r.replace(t,(s,n,o,i,a,c)=>{f("xRange",r,s,n,o,i,a,c);let u=b(o),d=u||b(i),m=d||b(a),w=m;return n==="="&&w&&(n=""),c=e.includePrerelease?"-0":"",u?s=n===">"||n==="<"?"<0.0.0-0":"*":n&&w?(d&&(i=0),a=0,n===">"?(n=">=",d?(o=+o+1,i=0,a=0):(i=+i+1,a=0)):n==="<="&&(n="<",d?o=+o+1:i=+i+1),n==="<"&&(c="-0"),s=`${n+o}.${i}.${a}${c}`):d?s=`>=${o}.0.0${c} <${+o+1}.0.0-0`:m&&(s=`>=${o}.${i}.0${c} <${o}.${+i+1}.0-0`),f("xRange return",s),s})},Sr=(r,e)=>(f("replaceStars",r,e),r.trim().replace(R[g.STAR],"")),xr=(r,e)=>(f("replaceGTE0",r,e),r.trim().replace(R[e.includePrerelease?g.GTE0PRE:g.GTE0],"")),Mr=r=>(e,t,s,n,o,i,a,c,u,d,m,w,S)=>`${t=b(s)?"":b(n)?`>=${s}.0.0${r?"-0":""}`:b(o)?`>=${s}.${n}.0${r?"-0":""}`:i?`>=${t}`:`>=${t}${r?"-0":""}`} ${c=b(u)?"":b(d)?`<${+u+1}.0.0-0`:b(m)?`<${u}.${+d+1}.0-0`:w?`<=${u}.${d}.${m}-${w}`:r?`<${u}.${d}.${+m+1}-0`:`<=${c}`}`.trim(),Nr=(r,e,t)=>{for(let s=0;s<r.length;s++)if(!r[s].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let s=0;s<r.length;s++)if(f(r[s].semver),r[s].semver!==Y.ANY&&r[s].semver.prerelease.length>0){let n=r[s].semver;if(n.major===e.major&&n.minor===e.minor&&n.patch===e.patch)return!0}return!1}return!0},ft=(r,e,t)=>{try{e=new Q(e,t)}catch{return!1}return e.test(r)};var{MAX_LENGTH:Cr}=$e,{re:mt,t:ht}=Z,Ar=(r,e)=>{if(e&&typeof e=="object"||(e={loose:!!e,includePrerelease:!1}),r instanceof C)return r;if(typeof r!="string"||r.length>Cr||!(e.loose?mt[ht.LOOSE]:mt[ht.FULL]).test(r))return null;try{return new C(r,e)}catch{return null}},$r=Ar,{re:le,t:de}=Z,gt=(r,e)=>{if(r instanceof C)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;let t=null;if((e=e||{}).rtl){let s;for(;(s=le[de.COERCERTL].exec(r))&&(!t||t.index+t[0].length!==r.length);)t&&s.index+s[0].length===t.index+t[0].length||(t=s),le[de.COERCERTL].lastIndex=s.index+s[1].length+s[2].length;le[de.COERCERTL].lastIndex=-1}else t=r.match(le[de.COERCE]);return t===null?null:$r(`${t[2]}.${t[3]||"0"}.${t[4]||"0"}`,e)};function Lr(r){return String.fromCharCode(parseInt(r.slice(1),16))}function Or(r){return`%${`00${r.charCodeAt(0).toString(16)}`.slice(-2)}`}function _r(r){return btoa(encodeURIComponent(r).replace(/%[0-9A-F]{2}/g,Lr))}function kr(r){return decodeURIComponent(Array.from(atob(r),Or).join(""))}function ee(r){return _r(JSON.stringify(r))}function Le(r){return JSON.parse(kr(r))}var x=require("@magic-sdk/types");var ue=require("@magic-sdk/types");function $(r){return typeof r>"u"}function Dr(r){return r===null}function pe(r){return Dr(r)||$(r)}function qr(r){return pe(r)?!1:!$(r.jsonrpc)&&!$(r.id)&&!$(r.method)&&!$(r.params)}function Oe(r){return pe(r)?!1:!$(r.jsonrpc)&&!$(r.id)&&(!$(r.result)||!$(r.error))}function Ur(r){return pe(r)?!1:typeof r=="string"&&Object.values(ue.MagicPayloadMethod).includes(r)}function _e(r){return pe(r)?!1:typeof r=="number"&&Object.values(ue.RPCErrorCode).includes(r)}function K(r){if(!r)return!0;for(let e in r)if(Object.hasOwnProperty.call(r,e))return!1;return!0}var E={};function yt(r,e){return Object.assign(E,e),r}var Rt={"magic-sdk":"magic-sdk","@magic-sdk/react-native":"magic-sdk-rn","@magic-sdk/react-native-bare":"magic-sdk-rn-bare","@magic-sdk/react-native-expo":"magic-sdk-rn-expo"};var L=class r extends Error{constructor(t,s){super(`Magic SDK Error: [${t}] ${s}`);this.code=t;this.rawMessage=s;Object.setPrototypeOf(this,r.prototype)}__proto__=Error},q=class r extends Error{__proto__=Error;code;rawMessage;data;constructor(e){super();let t=Number(e?.code);this.rawMessage=e?.message||"Internal error",this.code=_e(t)?t:x.RPCErrorCode.InternalError,this.message=`Magic RPC Error: [${this.code}] ${this.rawMessage}`,this.data=e?.data||void 0,Object.setPrototypeOf(this,r.prototype)}},O=class{constructor(e,t){this.code=e;this.rawMessage=t;this.message=`Magic SDK Warning: [${e}] ${t}`}message;log(){console.warn(this.message)}},te=class r extends Error{constructor(t,s,n,o){super(`Magic Extension Error (${t.name}): [${s}] ${n}`);this.code=s;this.rawMessage=n;this.data=o;Object.setPrototypeOf(this,r.prototype)}__proto__=Error},j=class{constructor(e,t,s){this.code=t;this.rawMessage=s;this.message=`Magic Extension Warning (${e.name}): [${t}] ${s}`}message;log(){console.warn(this.message)}};function ke(){return new L(x.SDKErrorCode.MissingApiKey,"Please provide an API key that you acquired from the Magic developer dashboard.")}function De(){return new L(x.SDKErrorCode.ModalNotReady,"Modal is not ready")}function qe(){return new L(x.SDKErrorCode.MalformedResponse,"Response from the Magic iframe is malformed.")}function Ue(r){return new L(x.SDKErrorCode.ExtensionNotInitialized,`Extensions must be initialized with a Magic SDK instance before \`Extension.${r}\` can be accessed. Do not invoke \`Extension.${r}\` inside an extension constructor.`)}function Fe(r){let e=`Some extensions are incompatible with \`${E.sdkName}@${E.version}\`:`;return r.filter(t=>typeof t.compat<"u"&&t.compat!==null).forEach(t=>{let s=t.compat[E.sdkName];typeof s=="string"?e+=`
  - Extension \`${t.name}\` supports version(s) \`${s}\``:s||(e+=`
  - Extension \`${t.name}\` does not support ${E.platform} environments.`)}),new L(x.SDKErrorCode.IncompatibleExtensions,e)}function We(r){let e=t=>{let s=t+1,n=s%10,o=s%100;return n===1&&o!==11?`${s}st`:n===2&&o!==12?`${s}nd`:n===3&&o!==13?`${s}rd`:`${s}th`};return new L(x.SDKErrorCode.InvalidArgument,`Invalid ${e(r.argument)} argument given to \`${r.procedure}\`.
  Expected: \`${r.expected}\`
  Received: \`${r.received}\``)}function Fr(){return new O(x.SDKWarningCode.DuplicateIframe,"Duplicate iframes found.")}function Je(){return new O(x.SDKWarningCode.SyncWeb3Method,"Non-async web3 methods are deprecated in web3 > 1.0 and are not supported by the Magic web3 provider. Please use an async method instead.")}function Ge(){return new O(x.SDKWarningCode.ReactNativeEndpointConfiguration,`CUSTOM DOMAINS ARE NOT SUPPORTED WHEN USING MAGIC SDK WITH REACT NATIVE! The \`endpoint\` parameter SHOULD NOT be provided. The Magic \`<iframe>\` is automatically wrapped by a WebView pointed at \`${E.defaultEndpoint}\`. Changing this default behavior will lead to unexpected results and potentially security-threatening bugs.`)}function Ke(r){let{method:e,removalVersions:t,useInstead:s}=r,n=t[E.sdkName],o=s?` Use \`${s}\` instead.`:"",i=`\`${e}\` will be removed from \`${E.sdkName}\` in version \`${n}\`.${o}`;return new O(x.SDKWarningCode.DeprecationNotice,i)}var p=require("@magic-sdk/types");var F=require("@magic-sdk/types");var bt=require("@magic-sdk/types");function*Wr(){let r=0;for(;;)r<Number.MAX_SAFE_INTEGER?yield++r:r=0}var Jr=Wr();function me(){return Jr.next().value}var re={};st(re,{clear:()=>Gr,getItem:()=>v,iterate:()=>je,key:()=>jr,keys:()=>Vr,length:()=>Kr,removeItem:()=>_,setItem:()=>N});var he;function U(r){return async(...e)=>(he||(he=await E.configureStorage()),await he.ready(),he[r](...e))}var v=U("getItem"),N=U("setItem"),_=U("removeItem"),Gr=U("clear"),Kr=U("length"),jr=U("key"),Vr=U("keys"),je=U("iterate");function Ve(){let r=window.crypto.getRandomValues(new Uint8Array(16));r[6]=r[6]&15|64,r[8]=r[8]&191|128;let e="";return e+=r[0].toString(16),e+=r[1].toString(16),e+=r[2].toString(16),e+=r[3].toString(16),e+="-",e+=r[4].toString(16),e+=r[5].toString(16),e+="-",e+=r[6].toString(16),e+=r[7].toString(16),e+="-",e+=r[8].toString(16),e+=r[9].toString(16),e+="-",e+=r[10].toString(16),e+=r[11].toString(16),e+=r[12].toString(16),e+=r[13].toString(16),e+=r[14].toString(16),e+=r[15].toString(16),e}var Ee="STORE_KEY_PRIVATE_KEY",ne="STORE_KEY_PUBLIC_JWK",Tt="ECDSA",Br="P-256",Hr={name:Tt,namedCurve:Br};function V(){let r=typeof window<"u"&&!!window.crypto,e=r&&!!window.crypto.subtle;return r&&e}function Be(){_(ne),_(Ee)}async function He(){let r=await Xr();if(!r){console.info("unable to create public key or webcrypto is unsupported");return}let{subtle:e}=window.crypto,t=await v(Ee);if(!t||!e){console.info("unable to find private key or webcrypto unsupported");return}let s={iat:Math.floor(new Date().getTime()/1e3),jti:Ve()},o={protected:vt(JSON.stringify({typ:"dpop+jwt",alg:"ES256",jwk:r})),claims:vt(JSON.stringify(s))},i=Yr(`${o.protected}.${o.claims}`),a={name:Tt,hash:{name:"SHA-256"}},c=Zr(new Uint8Array(await e.sign(a,t,i)));return`${o.protected}.${o.claims}.${c}`}async function Xr(){if(!V()){console.info("webcrypto is not supported");return}return await v(ne)||await zr(),v(ne)}async function zr(){let{subtle:r}=window.crypto,e=await r.generateKey(Hr,!1,["sign"]),t=await r.exportKey("jwk",e.publicKey);await N(Ee,e.privateKey),await N(ne,t)}function vt(r){return It(Qr(r))}function Yr(r){return new TextEncoder().encode(r)}function It(r){return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+/g,"")}function Qr(r){return encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,(t,s)=>String.fromCharCode(parseInt(s,16)))}function Zr(r){let e="";return r.forEach(t=>{e+=String.fromCharCode(t)}),It(e)}var Pt=Symbol("Payload pre-processed by Magic SDK");function wt(r){return Object.defineProperty(r,Pt,{value:!0,enumerable:!1}),r}function en(r){return!!r[Pt]}function W(r){return en(r)||(r.jsonrpc=r.jsonrpc??"2.0",r.id=me(),r.method=r.method??"noop",r.params=r.params??[],wt(r)),r}function h(r,e=[]){return wt({params:e,method:r,jsonrpc:"2.0",id:me()})}var B=class r{_jsonrpc;_id;_result;_error;constructor(e){e instanceof r?(this._jsonrpc=e.payload.jsonrpc,this._id=e.payload.id,this._result=e.payload.result,this._error=e.payload.error):Oe(e)?(this._jsonrpc=e.jsonrpc,this._id=e.id,this._result=e.result,this._error=e.error):(this._jsonrpc=e.jsonrpc,this._id=e.id,this._result=void 0,this._error=void 0)}applyError(e){return this._error=e,this}applyResult(e){return this._result=e,this}get hasError(){return this._error?.code===bt.RPCErrorCode.DpopInvalidated&&Be(),typeof this._error<"u"&&this._error!==null}get hasResult(){return typeof this._result<"u"}get payload(){return{jsonrpc:this._jsonrpc,id:this._id,result:this._result,error:this._error}}};var ye=require("@magic-sdk/types");var Mt=Xt(xt()),ge=class extends Mt.default{};function oe(){let r=new ge;return{emitter:r,createChainingEmitterMethod:(s,n)=>(...o)=>(r[s].apply(r,o),n),createBoundEmitterMethod:s=>(...n)=>r[s].apply(r,n)}}var Nt=Symbol("isPromiEvent");function ze(r){return!!r[Nt]}function I(r){let e=Re(r),{createBoundEmitterMethod:t,createChainingEmitterMethod:s}=oe(),n=Symbol("Promise.then"),o=Symbol("Promise.catch"),i=Symbol("Promise.finally"),a=(d,m)=>(...w)=>{let S=m[d].apply(m,w);return c(S)},c=d=>Object.assign(d,{[Nt]:!0,[n]:d[n]||d.then,[o]:d[o]||d.catch,[i]:d[i]||d.finally,then:a(n,d),catch:a(o,d),finally:a(i,d),on:s("on",d),once:s("once",d),addListener:s("addListener",d),off:s("off",d),removeListener:s("removeListener",d),removeAllListeners:s("removeAllListeners",d),emit:t("emit"),eventNames:t("eventNames"),listeners:t("listeners"),listenerCount:t("listenerCount")}),u=c(e.then(d=>(u.emit("done",d),u.emit("settled"),d),d=>{throw u.emit("error",d),u.emit("settled"),d}));return u.on(ye.UserEventsOnReceived.ClosedByUser,()=>{u.emit(ye.UserEventsEmit.ClosedByUser)}),u}function Re(r){return new Promise((e,t)=>{let s=r(e,t);Promise.resolve(s).catch(t)})}var y=class{constructor(e){this.sdk=e}get overlay(){return this.sdk.overlay}request(e){if(this.sdk.thirdPartyWallets.isConnected&&!F.routeToMagicMethods.includes(e.method))return I((i,a)=>{this.sdk.thirdPartyWallets.requestOverride(e).then(i).catch(a)});let t=this.overlay.post(F.MagicOutgoingWindowMessage.MAGIC_HANDLE_REQUEST,W(e)),s=I((o,i)=>{t.then(a=>{if(n(),a.hasError)i(new q(a.payload.error));else if(a.hasResult)o(a.payload.result);else throw qe()}).catch(a=>{n(),i(a)})}),n=this.overlay.on(F.MagicIncomingWindowMessage.MAGIC_HANDLE_EVENT,o=>{let{response:i}=o.data;if(i.id===e.id&&i.result?.event){let{event:a,params:c=[]}=i.result;s.emit(a,...c)}});return s}createIntermediaryEvent(e,t){return n=>{let o=h(F.MagicPayloadMethod.IntermediaryEvent,[{payloadId:t,eventType:e,args:n}]);this.request(o)}}};function Ye(r,e){let[t]=r.split(".").map(Number);return t>=e}var nn={"magic-sdk":"v18.0.0","@magic-sdk/react-native":"v14.0.0","@magic-sdk/react-native-bare":"v19.0.0","@magic-sdk/react-native-expo":"v19.0.0"},ve=class extends y{loginWithMagicLink(e){let t=E.sdkName==="@magic-sdk/react-native"||E.sdkName==="@magic-sdk/react-native-bare"||E.sdkName==="@magic-sdk/react-native-expo";if(t&&Ye(E.version,19))throw new Error("loginWithMagicLink() is deprecated for this package, please utlize a passcode method like loginWithSMS or loginWithEmailOTP instead.");t&&Ke({method:"auth.loginWithMagicLink()",removalVersions:nn,useInstead:"auth.loginWithEmailOTP()"}).log();let{email:s,showUI:n=!0,redirectURI:o,overrides:i,lifespan:a}=e,c=h(this.sdk.testMode?p.MagicPayloadMethod.LoginWithMagicLinkTestMode:p.MagicPayloadMethod.LoginWithMagicLink,[{email:s,showUI:n,redirectURI:o,overrides:i,lifespan:a}]);return this.request(c)}loginWithSMS(e){let{phoneNumber:t,showUI:s=!0,lifespan:n}=e,o=h(this.sdk.testMode?p.MagicPayloadMethod.LoginWithSmsTestMode:p.MagicPayloadMethod.LoginWithSms,[{phoneNumber:t,showUI:s,lifespan:n}]),i=this.request(o);return!s&&i&&(i.on(p.LoginWithSmsOTPEventEmit.VerifySmsOtp,a=>{this.createIntermediaryEvent(p.LoginWithSmsOTPEventEmit.VerifySmsOtp,o.id)(a)}),i.on(p.LoginWithSmsOTPEventEmit.Cancel,()=>{this.createIntermediaryEvent(p.LoginWithSmsOTPEventEmit.Cancel,o.id)()})),i}loginWithEmailOTP(e){let{email:t,showUI:s,deviceCheckUI:n,overrides:o,lifespan:i}=e,a=h(this.sdk.testMode?p.MagicPayloadMethod.LoginWithEmailOTPTestMode:p.MagicPayloadMethod.LoginWithEmailOTP,[{email:t,showUI:s,deviceCheckUI:n,overrides:o,lifespan:i}]),c=this.request(a);return!n&&c&&c.on(p.DeviceVerificationEventEmit.Retry,()=>{this.createIntermediaryEvent(p.DeviceVerificationEventEmit.Retry,a.id)()}),!s&&c&&(c.on(p.LoginWithEmailOTPEventEmit.VerifyEmailOtp,u=>{this.createIntermediaryEvent(p.LoginWithEmailOTPEventEmit.VerifyEmailOtp,a.id)(u)}),c.on(p.LoginWithEmailOTPEventEmit.VerifyMFACode,u=>{this.createIntermediaryEvent(p.LoginWithEmailOTPEventEmit.VerifyMFACode,a.id)(u)}),c.on(p.LoginWithEmailOTPEventEmit.LostDevice,()=>{this.createIntermediaryEvent(p.LoginWithEmailOTPEventEmit.LostDevice,a.id)()}),c.on(p.LoginWithEmailOTPEventEmit.VerifyRecoveryCode,u=>{this.createIntermediaryEvent(p.LoginWithEmailOTPEventEmit.VerifyRecoveryCode,a.id)(u)}),c.on(p.LoginWithEmailOTPEventEmit.Cancel,()=>{this.createIntermediaryEvent(p.LoginWithEmailOTPEventEmit.Cancel,a.id)()})),c}loginWithCredential(e){let{credentialOrQueryString:t,lifespan:s}=e||{},n=t??"";if(!t&&E.platform==="web"){n=window.location.search;let i=window.location.origin+window.location.pathname;window.history.replaceState(null,"",i)}let o=h(this.sdk.testMode?p.MagicPayloadMethod.LoginWithCredentialTestMode:p.MagicPayloadMethod.LoginWithCredential,[n,s]);return this.request(o)}setAuthorizationToken(e){let t=h(p.MagicPayloadMethod.SetAuthorizationToken,[{jwt:e}]);return this.request(t)}updateEmailWithUI(e){let{email:t,showUI:s=!0}=e,n=h(this.sdk.testMode?p.MagicPayloadMethod.UpdateEmailTestMode:p.MagicPayloadMethod.UpdateEmail,[{email:t,showUI:s}]),o=this.request(n);return s||(o.on(p.RecencyCheckEventEmit.Retry,()=>{this.createIntermediaryEvent(p.RecencyCheckEventEmit.Retry,n.id)()}),o.on(p.RecencyCheckEventEmit.Cancel,()=>{this.createIntermediaryEvent(p.RecencyCheckEventEmit.Cancel,n.id)()}),o.on(p.RecencyCheckEventEmit.VerifyEmailOtp,i=>{this.createIntermediaryEvent(p.RecencyCheckEventEmit.VerifyEmailOtp,n.id)(i)}),o.on(p.RecencyCheckEventEmit.VerifyMFACode,i=>{this.createIntermediaryEvent(p.RecencyCheckEventEmit.VerifyMFACode,n.id)(i)}),o.on(p.UpdateEmailEventEmit.RetryWithNewEmail,i=>{this.createIntermediaryEvent(p.UpdateEmailEventEmit.RetryWithNewEmail,n.id)(i)}),o.on(p.UpdateEmailEventEmit.Cancel,()=>{this.createIntermediaryEvent(p.UpdateEmailEventEmit.Cancel,n.id)()}),o.on(p.UpdateEmailEventEmit.VerifyEmailOtp,i=>{this.createIntermediaryEvent(p.UpdateEmailEventEmit.VerifyEmailOtp,n.id)(i)})),o}};var l=require("@magic-sdk/types");var Qe="ds",Ze="ek",et="iv",tt="AES-GCM",sn=256;async function Te(){let r=[];await je((e,t,s)=>{t.startsWith(`${Qe}_`)&&r.push(t)});for(let e of r)await _(e)}function Ct(r){let e="",t=new Uint8Array(r),s=t.byteLength;for(let n=0;n<s;n++)e+=String.fromCharCode(t[n]);return window.btoa(e)}function At(r){let e=window.atob(r),t=e.length,s=new Uint8Array(t);for(let n=0;n<t;n++)s[n]=e.charCodeAt(n);return s.buffer}async function on(){if(!V()){console.info("webcrypto is not supported");return}let{crypto:r}=window,e=await v(et);return e||r.getRandomValues(new Uint8Array(12))}async function an(){if(!V()){console.info("webcrypto is not supported");return}let{subtle:r}=window.crypto,e=await v(Ze);return e||await r.generateKey({name:tt,length:sn},!1,["encrypt","decrypt"])}async function $t(r,e){let t=await on(),s=await an();if(!t||!s||!r)return;let n=At(r),{subtle:o}=window.crypto,i=await o.encrypt({name:tt,iv:t},s,n),a=Ct(i);await N(`${Qe}_${e}`,a),await N(Ze,s),await N(et,t)}async function Lt(r){let e=await v(`${Qe}_${r}`),t=await v(et),s=await v(Ze);if(!t||!e||!s||!V())return;let{subtle:n}=window.crypto,o=await n.decrypt({name:tt,iv:t},s,At(e));return Ct(o)}function Ie(r,e){return e?new URL(r,e):new URL(r)}var be=class extends y{getIdToken(e){let t=h(this.sdk.testMode?l.MagicPayloadMethod.GetIdTokenTestMode:l.MagicPayloadMethod.GetIdToken,[e]);return this.request(t)}generateIdToken(e){let t=h(this.sdk.testMode?l.MagicPayloadMethod.GenerateIdTokenTestMode:l.MagicPayloadMethod.GenerateIdToken,[e]);return this.request(t)}getInfo(){let e=h(l.MagicPayloadMethod.GetInfo,[]);return this.request(e)}isLoggedIn(){return I(async(e,t)=>{try{let s=!1;this.sdk.useStorageCache&&(s=await v(this.localForageIsLoggedInKey)==="true",s&&e(!0));let n=h(this.sdk.testMode?l.MagicPayloadMethod.IsLoggedInTestMode:l.MagicPayloadMethod.IsLoggedIn),o=await this.request(n);this.sdk.useStorageCache&&(o?N(this.localForageIsLoggedInKey,!0):_(this.localForageIsLoggedInKey),s&&!o&&this.emitUserLoggedOut(!0)),e(o)}catch(s){t(s)}})}logout(){return _(this.localForageIsLoggedInKey),Te(),I(async(e,t)=>{try{let s=h(this.sdk.testMode?l.MagicPayloadMethod.LogoutTestMode:l.MagicPayloadMethod.Logout),n=await this.request(s);this.sdk.useStorageCache&&this.emitUserLoggedOut(n),e(n)}catch(s){t(s)}})}requestInfoWithUI(e){let t=h(l.MagicPayloadMethod.RequestUserInfoWithUI,e?[e]:[]);return this.request(t)}showSettings(e){let{showUI:t=!0}=e||{},s=h(this.sdk.testMode?l.MagicPayloadMethod.UserSettingsTestMode:l.MagicPayloadMethod.UserSettings,[e]),n=this.request(s);return!t&&n&&(n.on(l.RecoveryFactorEventEmit.SendNewPhoneNumber,o=>{this.createIntermediaryEvent(l.RecoveryFactorEventEmit.SendNewPhoneNumber,s.id)(o)}),n.on(l.RecoveryFactorEventEmit.SendOtpCode,o=>{this.createIntermediaryEvent(l.RecoveryFactorEventEmit.SendOtpCode,s.id)(o)}),n.on(l.RecoveryFactorEventEmit.StartEditPhoneNumber,()=>{this.createIntermediaryEvent(l.RecoveryFactorEventEmit.StartEditPhoneNumber,s.id)()}),n.on(l.RecoveryFactorEventEmit.Cancel,()=>{this.createIntermediaryEvent(l.RecoveryFactorEventEmit.Cancel,s.id)()}),n.on(l.RecencyCheckEventEmit.VerifyEmailOtp,o=>{this.createIntermediaryEvent(l.RecencyCheckEventEmit.VerifyEmailOtp,s.id)(o)})),n}recoverAccount(e){let{email:t,showUI:s}=e,n=h(this.sdk.testMode?l.MagicPayloadMethod.RecoverAccountTestMode:l.MagicPayloadMethod.RecoverAccount,[{email:t,showUI:s}]),o=this.request(n);return!s&&o&&(o.on(l.RecoverAccountEventEmit.Cancel,()=>{this.createIntermediaryEvent(l.RecoverAccountEventEmit.Cancel,n.id)()}),o.on(l.RecoverAccountEventEmit.ResendSms,()=>{this.createIntermediaryEvent(l.RecoverAccountEventEmit.ResendSms,n.id)()}),o.on(l.RecoverAccountEventEmit.VerifyOtp,i=>{this.createIntermediaryEvent(l.RecoverAccountEventEmit.VerifyOtp,n.id)(i)}),o.on(l.RecoverAccountEventEmit.UpdateEmail,i=>{this.createIntermediaryEvent(l.RecoverAccountEventEmit.UpdateEmail,n.id)(i)}),o.on(l.UpdateEmailEventEmit.Cancel,()=>{this.createIntermediaryEvent(l.UpdateEmailEventEmit.Cancel,n.id)()}),o.on(l.UpdateEmailEventEmit.RetryWithNewEmail,i=>{this.createIntermediaryEvent(l.UpdateEmailEventEmit.RetryWithNewEmail,n.id)(i)}),o.on(l.UpdateEmailEventEmit.VerifyEmailOtp,i=>{this.createIntermediaryEvent(l.UpdateEmailEventEmit.VerifyEmailOtp,n.id)(i)})),o}revealPrivateKey(){let e=h(l.MagicPayloadMethod.RevealPK);return this.request(e)}onUserLoggedOut(e){this.userLoggedOutCallbacks.push(e)}enableMFA(e){let{showUI:t=!0}=e,s=h(l.MagicPayloadMethod.EnableMFA,[{showUI:t}]),n=this.request(s);return!t&&n&&(n.on(l.EnableMFAEventEmit.VerifyMFACode,o=>{this.createIntermediaryEvent(l.EnableMFAEventEmit.VerifyMFACode,s.id)(o)}),n.on(l.EnableMFAEventEmit.Cancel,()=>{this.createIntermediaryEvent(l.EnableMFAEventEmit.Cancel,s.id)()})),n}disableMFA(e){let{showUI:t=!0}=e,s=h(l.MagicPayloadMethod.DisableMFA,[{showUI:t}]),n=this.request(s);return!t&&n&&(n.on(l.DisableMFAEventEmit.VerifyMFACode,o=>{this.createIntermediaryEvent(l.DisableMFAEventEmit.VerifyMFACode,s.id)(o)}),n.on(l.DisableMFAEventEmit.LostDevice,o=>{this.createIntermediaryEvent(l.DisableMFAEventEmit.LostDevice,s.id)(o)}),n.on(l.DisableMFAEventEmit.Cancel,()=>{this.createIntermediaryEvent(l.DisableMFAEventEmit.Cancel,s.id)()})),n}emitUserLoggedOut(e){this.userLoggedOutCallbacks.forEach(t=>{t(e)})}localForageIsLoggedInKey="magic_auth_is_logged_in";userLoggedOutCallbacks=[]};var k=require("@magic-sdk/types");var Pe=class extends y{connectWithUI(e){let t=I(async(s,n)=>{try{let o=h(k.MagicPayloadMethod.Login,[{enabledWallets:this.sdk.thirdPartyWallets.enabledWallets,...e}]),i=this.request(o);this.sdk.thirdPartyWallets.eventListeners.forEach(({event:c,callback:u})=>{i.on(c,()=>u(o.id))}),i.on("id-token-created",c=>{t.emit("id-token-created",c)});let a=await i;a.error&&n(a),s(a)}catch(o){n(o)}});return t}showUI(e){return this.request(h(k.MagicPayloadMethod.ShowUI,[e]))}showAddress(){return this.request(h(k.MagicPayloadMethod.ShowAddress))}showSendTokensUI(){return this.request(h(k.MagicPayloadMethod.ShowSendTokensUI))}showOnRamp(){return this.request(h(k.MagicPayloadMethod.ShowOnRamp))}showNFTs(){return this.request(h(k.MagicPayloadMethod.ShowNFTs))}showBalances(){return this.request(h(k.MagicPayloadMethod.ShowBalances))}sendGaslessTransaction(e,t){return this.request(h(k.MagicPayloadMethod.SendGaslessTransaction,[e,t]))}};var M=require("@magic-sdk/types");var we=class extends y{eventListeners=[];enabledWallets={};isConnected=!1;resetThirdPartyWalletState(){localStorage.removeItem(M.LocalStorageKeys.PROVIDER),localStorage.removeItem(M.LocalStorageKeys.ADDRESS),localStorage.removeItem(M.LocalStorageKeys.CHAIN_ID),this.isConnected=!1}requestOverride(e){if(e.method===M.MagicPayloadMethod.Login)return this.resetThirdPartyWalletState(),super.request(e);if(e.method===M.MagicPayloadMethod.GetInfo)return this.getInfo(e);if(e.method===M.MagicPayloadMethod.IsLoggedIn)return this.isLoggedIn(e);if(e.method===M.MagicPayloadMethod.Logout)return this.logout(e);switch(localStorage.getItem(M.LocalStorageKeys.PROVIDER)){case"web3modal":return this.web3modalRequest(e);default:return this.resetThirdPartyWalletState(),super.request(e)}}isLoggedIn(e){switch(localStorage.getItem(M.LocalStorageKeys.PROVIDER)){case"web3modal":return this.web3modalIsLoggedIn();default:return this.resetThirdPartyWalletState(),super.request(e)}}getInfo(e){switch(localStorage.getItem(M.LocalStorageKeys.PROVIDER)){case"web3modal":return this.web3modalGetInfo();default:return this.resetThirdPartyWalletState(),super.request(e)}}logout(e){let t=localStorage.getItem(M.LocalStorageKeys.PROVIDER);switch(this.resetThirdPartyWalletState(),t){case"web3modal":return this.web3modalLogout();default:return super.request(e)}}web3modalRequest(e){return I((t,s)=>{this.sdk.web3modal.modal.getWalletProvider().request(e).then(t).catch(s)})}web3modalIsLoggedIn(){return I(e=>{let t=this.sdk.web3modal.modal.getStatus();if(t==="connected"&&e(!0),t==="disconnected"&&(this.resetThirdPartyWalletState(),e(!1)),t==="reconnecting"){let s=this.sdk.web3modal.modal.subscribeProvider(({status:n})=>{n==="connected"&&(s(),e(!0)),n==="disconnected"&&(s(),this.resetThirdPartyWalletState(),e(!1))})}})}formatWeb3modalGetInfoResponse(){let e=this.sdk.web3modal.modal.getWalletInfo()?.name,t=this.sdk.web3modal.modal.getAddress();return{publicAddress:t,email:null,issuer:`did:ethr:${t}`,phoneNumber:null,isMfaEnabled:!1,recoveryFactors:[],walletType:e||"web3modal",firstLoginAt:null}}web3modalGetInfo(){return I((e,t)=>{let s=this.sdk.web3modal.modal.getStatus();if(s==="connected"&&e(this.formatWeb3modalGetInfoResponse()),s==="disconnected"&&(this.resetThirdPartyWalletState(),t("Magic RPC Error: [-32603] Internal error: User denied account access.")),s==="reconnecting"){let n=this.sdk.web3modal.modal.subscribeProvider(({status:o})=>{o==="connected"&&(n(),e(this.formatWeb3modalGetInfoResponse())),o==="disconnected"&&(n(),this.resetThirdPartyWalletState(),t("Magic RPC Error: [-32603] Internal error: User denied account access."))})}})}web3modalLogout(){return I(async e=>{try{await this.sdk.web3modal.modal.disconnect()}catch(t){console.error(t)}e(!0)})}};var ie=require("@magic-sdk/types");var{createBoundEmitterMethod:Se,createChainingEmitterMethod:H}=oe(),xe=class extends y{isMagic=!0;sendAsync(e,t){if(!t)throw We({procedure:"Magic.rpcProvider.sendAsync",argument:1,expected:"function",received:t===null?"null":typeof t});if(Array.isArray(e))this.overlay.post(ie.MagicOutgoingWindowMessage.MAGIC_HANDLE_REQUEST,e.map(s=>{let n=W(s);return this.prefixPayloadMethodForTestMode(n),n})).then(s=>{t(null,s.map(n=>({...n.payload,error:n.hasError?new q(n.payload.error):null})))});else{let s=W(e);this.prefixPayloadMethodForTestMode(s),this.overlay.post(ie.MagicOutgoingWindowMessage.MAGIC_HANDLE_REQUEST,s).then(n=>{t(n.hasError?new q(n.payload.error):null,n.payload)})}}send(e,t){if(typeof e=="string"){let n=h(e,Array.isArray(t)?t:[]);return this.request(n)}if(Array.isArray(e)||t){this.sendAsync(e,t);return}let s=Je();return s.log(),new B(e).applyError({code:-32603,message:s.rawMessage}).payload}enable(){let e=h(ie.MagicPayloadMethod.Login);return this.request(e)}request(e){return this.prefixPayloadMethodForTestMode(e),super.request(e)}prefixPayloadMethodForTestMode(e){let t="testMode/eth/";this.sdk.testMode&&(e.method=`${t}${e.method}`)}on=H("on",this);once=H("once",this);addListener=H("addListener",this);off=H("off",this);removeListener=H("removeListener",this);removeAllListeners=H("removeAllListeners",this);emit=Se("emit");eventNames=Se("eventNames");listeners=Se("listeners");listenerCount=Se("listenerCount")};var Ot=["request","overlay","sdk"];function cn(r){let e=Object.getPrototypeOf(r),t=[e];for(;e!==y.prototype;)e=Object.getPrototypeOf(e),t.push(e);return t}var rt=class extends y{compat;__sdk_access_field_descriptors__=new Map;__is_initialized__=!1;utils={createPromiEvent:I,isPromiEvent:ze,encodeJSON:ee,decodeJSON:Le,createJsonRpcRequestPayload:h,standardizeJsonRpcRequestPayload:W,storage:re};constructor(){super(void 0);let e=[this,...cn(this)];Ot.forEach(t=>{let s=e.map(a=>Object.getOwnPropertyDescriptor(a,t)),n=s.findIndex(a=>!!a),o=n>0,i=s[n];i&&(this.__sdk_access_field_descriptors__.set(t,{descriptor:i,isPrototypeField:o}),Object.defineProperty(this,t,{configurable:!0,get:()=>{throw Ue(t)}}))})}init(e){this.__is_initialized__||(Ot.forEach(t=>{if(this.__sdk_access_field_descriptors__.has(t)){let{descriptor:s,isPrototypeField:n}=this.__sdk_access_field_descriptors__.get(t);n?delete this[t]:Object.defineProperty(this,t,s)}}),this.sdk=e,this.__is_initialized__=!0)}createDeprecationWarning(e){let{method:t,removalVersion:s,useInstead:n}=e,o=n?` Use \`${n}\` instead.`:"",i=`\`${t}\` will be removed from this Extension in version \`${s}\`.${o}`;return new j(this,"DEPRECATION_NOTICE",i)}createWarning(e,t){return new j(this,e,t)}createError(e,t,s){return new te(this,e,t,s)}},nt=class extends rt{},J=class{static Internal=nt};var D=require("@magic-sdk/types");var Me=class extends y{purchase(e){let t=h(D.MagicPayloadMethod.NFTPurchase,[e]);return this.request(t)}checkout(e){let t=this.sdk.thirdPartyWallets.isConnected,s=h(D.MagicPayloadMethod.NFTCheckout,[{...e,walletProvider:t?"web3modal":"magic"}]),n=this.request(s);return t&&(n.on(D.NftCheckoutIntermediaryEvents.Initiated,async o=>{try{let i=await this.request({method:"eth_sendTransaction",params:[o]});this.createIntermediaryEvent(D.NftCheckoutIntermediaryEvents.Success,s.id)(i)}catch{this.createIntermediaryEvent(D.NftCheckoutIntermediaryEvents.Failure,s.id)()}}),n.on(D.NftCheckoutIntermediaryEvents.Disconnect,()=>{this.sdk.thirdPartyWallets.resetThirdPartyWalletState(),n.emit("disconnect")})),n}transfer(e){let t=h(D.MagicPayloadMethod.NFTTransfer,[e]);return this.request(t)}};function _t(r){return r.compat&&r.compat[E.sdkName]!=null?typeof r.compat[E.sdkName]=="string"?ft(gt(E.version),r.compat[E.sdkName]):!!r.compat[E.sdkName]:!0}function ln(r,e,t){return!e&&!t?`${r}_eth_mainnet`:t?`${r}_${JSON.stringify(t)}`:e?typeof e=="string"?`${r}_eth_${e}`:`${r}_${e.rpcUrl}_${e.chainId}_${e.chainType}`:`${r}_unknown`}function dn(r){let e=r?.extensions??[],t={},s=[];if(Array.isArray(e)?e.forEach(n=>{_t(n)?(n.init(this),n.name&&(this[n.name]=n),n instanceof J.Internal&&(K(n.config)||(t[n.name]=n.config))):s.push(n)}):Object.keys(e).forEach(n=>{if(_t(e[n])){e[n].init(this);let o=e[n];this[n]=o,o instanceof J.Internal&&(K(o.config)||(t[e[n].name]=o.config))}else s.push(e[n])}),s.length)throw Fe(s);return t}var Ne=class r{constructor(e,t){this.apiKey=e;if(!e)throw ke();E.platform==="react-native"&&t?.endpoint&&Ge().log();let{defaultEndpoint:s,version:n}=E;this.testMode=!!t?.testMode,this.useStorageCache=!!t?.useStorageCache,this.endpoint=Ie(t?.endpoint??s).origin,this.auth=new ve(this),this.user=new be(this),this.wallet=new Pe(this),this.nft=new Me(this),this.thirdPartyWallets=new we(this),this.rpcProvider=new xe(this);let o=dn.call(this,t);this.parameters=ee({API_KEY:this.apiKey,DOMAIN_ORIGIN:window.location?window.location.origin:"",ETH_NETWORK:t?.network,host:Ie(this.endpoint).host,sdk:Rt[E.sdkName],version:n,ext:K(o)?void 0:o,locale:t?.locale||"en_US",...E.bundleId?{bundleId:E.bundleId}:{},meta:t?.meta}),this.networkHash=ln(this.apiKey,t?.network,K(o)?void 0:o),t?.deferPreload||this.preload()}static __overlays__=new Map;endpoint;parameters;networkHash;testMode;useStorageCache;auth;user;wallet;nft;thirdPartyWallets;rpcProvider;get overlay(){if(!r.__overlays__.has(this.parameters)){let e=new E.ViewController(this.endpoint,this.parameters,this.networkHash);e.init(),r.__overlays__.set(this.parameters,e)}return r.__overlays__.get(this.parameters)}async preload(){await this.overlay.waitForReady()}};var A=require("@magic-sdk/types");function un(r,e){return e&&Array.isArray(r)?r.find(t=>t.id===e):r}function kt(r,e){let t=e.data.response?.id,s=un(r,t);if(t&&s){let n=new B(s).applyResult(e.data.response.result).applyError(e.data.response.error);return{id:t,response:n}}return{}}async function Dt(r,e,t){let s=await v("rt"),n;if(E.platform==="web")try{n=await v("jwt")??await He()}catch(a){console.error("webcrypto error",a)}let o={msgType:r,payload:e};n&&(o.jwt=n),n&&s&&(o.rt=s);let i=await Lt(t);return i&&(o.deviceShare=i),o}async function qt(r){r.data.rt&&await N("rt",r.data.rt)}function Ut(r,e){let t=null;return function(...s){t&&clearTimeout(t),t=setTimeout(()=>{r(...s)},e)}}var pn=1e3,Wt=60*pn,Ft=5*Wt,mn=60*Wt,Ce=class{constructor(e,t,s){this.endpoint=e;this.parameters=t;this.networkHash=s;this.listen()}isReadyForRequest=!1;messageHandlers=new Set;isConnectedToInternet=!0;lastPongTime=null;heartbeatIntervalTimer=null;heartbeatDebounce=Ut(()=>{this.endpoint==="https://auth.magic.link/"&&this.heartBeatCheck()},mn);async post(e,t){return Re(async(s,n)=>{if(!this.isConnectedToInternet){let d=De();n(d)}await this.checkRelayerExistsInDOM()||(this.isReadyForRequest=!1,await this.reloadRelayer()),this.isReadyForRequest||await this.waitForReady();let o=[],i=Array.isArray(t)?t.map(d=>d.id):[],a=await Dt(`${e}-${this.parameters}`,t,this.networkHash);await this._post(a);let c=d=>m=>{let{id:w,response:S}=kt(t,m);if(qt(m),S?.payload.error?.message==="User denied account access.")Te();else if(m.data.deviceShare){let{deviceShare:Jt}=m.data;$t(Jt,this.networkHash)}w&&S&&Array.isArray(t)&&i.includes(w)?(o.push(S),o.length===t.length&&(d(),s(o))):w&&S&&!Array.isArray(t)&&w===t.id&&(d(),s(S))},u=this.on(A.MagicIncomingWindowMessage.MAGIC_HANDLE_RESPONSE,c(()=>u()))})}on(e,t){let s=t.bind(window),n=o=>{o.data.msgType===`${e}-${this.parameters}`&&s(o)};return this.messageHandlers.add(n),()=>this.messageHandlers.delete(n)}waitForReady(){return new Promise(e=>{let t=this.on(A.MagicIncomingWindowMessage.MAGIC_OVERLAY_READY,()=>{this.isReadyForRequest=!0,e(),t()})})}listen(){this.on(A.MagicIncomingWindowMessage.MAGIC_HIDE_OVERLAY,()=>{this.hideOverlay()}),this.on(A.MagicIncomingWindowMessage.MAGIC_SHOW_OVERLAY,()=>{this.showOverlay()}),this.on(A.MagicIncomingWindowMessage.MAGIC_SEND_PRODUCT_ANNOUNCEMENT,e=>{e.data.response.result.product_announcement&&new O(A.SDKWarningCode.ProductAnnouncement,e.data.response.result.product_announcement).log()})}heartBeatCheck(){let e=!0,t=async()=>{let s={msgType:`${A.MagicOutgoingWindowMessage.MAGIC_PING}-${this.parameters}`,payload:[]};await this._post(s)};this.heartbeatIntervalTimer=setInterval(async()=>{if(this.lastPongTime){if(Date.now()-this.lastPongTime>Ft*2){this.reloadRelayer(),e=!0;return}}else if(!e){this.reloadRelayer(),e=!0;return}await t(),e=!1},Ft)}stopHeartBeat(){this.heartbeatDebounce(),this.lastPongTime=null,this.heartbeatIntervalTimer&&(clearInterval(this.heartbeatIntervalTimer),this.heartbeatIntervalTimer=null)}};
//# sourceMappingURL=index.js.map
